



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Scone Documentation - Secure Containers">
      
      
        <link rel="canonical" href="https://sconedocs.github.io/groupcacheUseCase/">
      
      
        <meta name="author" content="Christof Fetzer">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.2">
    
    
      
        <title>GO example - SCONE</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.ba0fd1a6.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#groupcache-example" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://sconedocs.github.io" title="SCONE" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                SCONE
              </span>
              <span class="md-header-nav__topic">
                GO example
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    SCONE
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Use Cases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Use Cases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../usecases/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pyspark/" title="PySpark" class="md-nav__link">
      PySpark
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tensorflowlite/" title="TensorFlow Lite" class="md-nav__link">
      TensorFlow Lite
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../outline/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../firstcontainer/" title="Simulation Mode" class="md-nav__link">
      Simulation Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hardwaremode/" title="Hardware Mode" class="md-nav__link">
      Hardware Mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hostexample/" title="Host Execution" class="md-nav__link">
      Host Execution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerfileexample/" title="Dockerfile Example" class="md-nav__link">
      Dockerfile Example
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        GO example
      </label>
    
    <a href="./" title="GO example" class="md-nav__link md-nav__link--active">
      GO example
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#building-groupcache-without-shielding" title="Building groupcache - without shielding" class="md-nav__link">
    Building groupcache - without shielding
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shielding" title="Shielding" class="md-nav__link">
    Shielding
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alternative-manual-modifications" title="Alternative: Manual Modifications" class="md-nav__link">
    Alternative: Manual Modifications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-scone-shielding" title="Alternative: SCONE shielding" class="md-nav__link">
    Alternative: SCONE shielding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Installation overview" class="md-nav__link">
      Installation overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dockerinstall/" title="Installing docker" class="md-nav__link">
      Installing docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sgxinstall/" title="Installing Intel SGX driver" class="md-nav__link">
      Installing Intel SGX driver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sconeinstall/" title="Installing SCONE" class="md-nav__link">
      Installing SCONE
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Language Support
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Language Support
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../C/" title="C" class="md-nav__link">
      C
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../C++/" title="C++" class="md-nav__link">
      C++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Fortran/" title="Fortran" class="md-nav__link">
      Fortran
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GO/" title="GO" class="md-nav__link">
      GO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Java/" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pypyscone/" title="PyPy" class="md-nav__link">
      PyPy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nodejs/" title="Node" class="md-nav__link">
      Node
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Rust/" title="Rust" class="md-nav__link">
      Rust
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Command Line Interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Command Line Interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_CLI/" title="SCONE CLI" class="md-nav__link">
      SCONE CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_HOST_SETUP/" title="SCONE Host Setup" class="md-nav__link">
      SCONE Host Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_toolchain/" title="SCONE SGX toolchain" class="md-nav__link">
      SCONE SGX toolchain
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Curated_Images/" title="SCONE Curated Images" class="md-nav__link">
      SCONE Curated Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_TUTORIAL/" title="SCONE Hello World" class="md-nav__link">
      SCONE Hello World
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_GENERATE_IMAGE/" title="SCONE Create Image" class="md-nav__link">
      SCONE Create Image
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Dockerfile/" title="SCONE Dockerfile" class="md-nav__link">
      SCONE Dockerfile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Swarm_Example/" title="SCONE Swarm Example" class="md-nav__link">
      SCONE Swarm Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Compose/" title="SCONE Compose" class="md-nav__link">
      SCONE Compose
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_CAS/" title="SCONE CAS" class="md-nav__link">
      SCONE CAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_EE2EE/" title="Example E2E encryption" class="md-nav__link">
      Example E2E encryption
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Manuals
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Manuals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_HOST/" title="scone host" class="md-nav__link">
      scone host
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_SERVICE/" title="scone service" class="md-nav__link">
      scone service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_STACK/" title="scone stack" class="md-nav__link">
      scone stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_SWARM/" title="scone swarm" class="md-nav__link">
      scone swarm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_VOLUME/" title="scone volume" class="md-nav__link">
      scone volume
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_Fileshield/" title="scone fspf" class="md-nav__link">
      scone fspf
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ssh/" title="ssh setup" class="md-nav__link">
      ssh setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SCONE_ENV/" title="environment variables" class="md-nav__link">
      environment variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MrEnclave/" title="MrEnclave" class="md-nav__link">
      MrEnclave
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../performance/" title="Performance" class="md-nav__link">
      Performance
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Background
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Background
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../appsecurity/" title="Application-Oriented Security" class="md-nav__link">
      Application-Oriented Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../background/" title="SCONE Background" class="md-nav__link">
      SCONE Background
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SCONE_Publications/" title="Publications" class="md-nav__link">
      Publications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      About Scone
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        About Scone
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aboutScone/" title="About" class="md-nav__link">
      About
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../news/" title="News Log" class="md-nav__link">
      News Log
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#building-groupcache-without-shielding" title="Building groupcache - without shielding" class="md-nav__link">
    Building groupcache - without shielding
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shielding" title="Shielding" class="md-nav__link">
    Shielding
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alternative-manual-modifications" title="Alternative: Manual Modifications" class="md-nav__link">
    Alternative: Manual Modifications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-scone-shielding" title="Alternative: SCONE shielding" class="md-nav__link">
    Alternative: SCONE shielding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="groupcache-example">groupcache Example<a class="headerlink" href="#groupcache-example" title="Permanent link">&para;</a></h1>
<p><strong><a href="https://github.com/golang/groupcache">groupcache</a></strong> is a memcached-like library written in GO:
it implements a peer-to-peer caching service.
We use <strong>groupcache</strong> to show how to build a little more complex GO program with SCONE.</p>
<p>Typically, one would build a container image for <strong>groupcache</strong> with a <a href="../dockerfileexample">Dockerfile</a>.
Since our emphasis is to explain how to build such programs,
we try to show the individual steps to compile and execute <strong>groupcache</strong> instead.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You might want to read how to <a href="../GO/">compile GO programs</a> with SCONE first.</p>
</div>
<h2 id="building-groupcache-without-shielding">Building <strong>groupcache</strong> - without shielding<a class="headerlink" href="#building-groupcache-without-shielding" title="Permanent link">&para;</a></h2>
<p>First, start a crosscompiler container. Give it access to the <strong>sgx device</strong> if your host has 
this device - otherwise, just drop argument <strong>--device=/dev/isgx</strong>:</p>
<div class="codehilite"><pre><span></span>docker run --device<span class="o">=</span>/dev/isgx -it  sconecuratedimages/crosscompilers
</pre></div>

<p>Second, install the <strong>go</strong> command to simplify the building of <strong>groupcache</strong>:</p>
<div class="codehilite"><pre><span></span>apk update
apk add go git curl
</pre></div>

<p>Now you can build the <strong>groupcache</strong> library as follows:</p>
<div class="codehilite"><pre><span></span>go get -compiler gccgo -u github.com/golang/groupcache
</pre></div>

<p>Note that flag <strong>-compiler gccgo</strong> is required to ensure that the scone-gccgo is used to compile <strong>groupcache</strong>.</p>
<p><strong>That's it!</strong>  </p>
<h3 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h3>
<p>OK, we should show how to use group cache. We show this for a simple application from <a href="https://gist.github.com/fiorix/816117cfc7573319b72d">fiorix</a>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">cat</span> <span class="p">&gt;</span> <span class="nx">groupcache</span><span class="p">.</span><span class="k">go</span> <span class="o">&lt;&lt;</span> <span class="nx">EOF</span>
<span class="c1">// Simple groupcache example: https://github.com/golang/groupcache</span>
<span class="c1">// Running 3 instances:</span>
<span class="c1">// go run groupcache.go -addr=:8080 -pool=http://127.0.0.1:8080,http://127.0.0.1:8081,http://127.0.0.1:8082</span>
<span class="c1">// go run groupcache.go -addr=:8081 -pool=http://127.0.0.1:8081,http://127.0.0.1:8080,http://127.0.0.1:8082</span>
<span class="c1">// go run groupcache.go -addr=:8082 -pool=http://127.0.0.1:8082,http://127.0.0.1:8080,http://127.0.0.1:8081</span>
<span class="c1">// Testing:</span>
<span class="c1">// curl localhost:8080/color?name=red</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;errors&quot;</span>
    <span class="s">&quot;flag&quot;</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
    <span class="s">&quot;strings&quot;</span>

    <span class="s">&quot;github.com/golang/groupcache&quot;</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="nx">Store</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="kt">byte</span><span class="p">{</span>
    <span class="s">&quot;red&quot;</span><span class="p">:</span>   <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;#FF0000&quot;</span><span class="p">),</span>
    <span class="s">&quot;green&quot;</span><span class="p">:</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;#00FF00&quot;</span><span class="p">),</span>
    <span class="s">&quot;blue&quot;</span><span class="p">:</span>  <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;#0000FF&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">Group</span> <span class="p">=</span> <span class="nx">groupcache</span><span class="p">.</span><span class="nx">NewGroup</span><span class="p">(</span><span class="s">&quot;foobar&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="o">&lt;&lt;</span><span class="mi">20</span><span class="p">,</span> <span class="nx">groupcache</span><span class="p">.</span><span class="nx">GetterFunc</span><span class="p">(</span>
    <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">groupcache</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">key</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">dest</span> <span class="nx">groupcache</span><span class="p">.</span><span class="nx">Sink</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;looking up&quot;</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
        <span class="nx">v</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">Store</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;color not found&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">dest</span><span class="p">.</span><span class="nx">SetBytes</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">},</span>
<span class="p">))</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">addr</span> <span class="o">:=</span> <span class="nx">flag</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="s">&quot;addr&quot;</span><span class="p">,</span> <span class="s">&quot;:8080&quot;</span><span class="p">,</span> <span class="s">&quot;server address&quot;</span><span class="p">)</span>
    <span class="nx">peers</span> <span class="o">:=</span> <span class="nx">flag</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="s">&quot;pool&quot;</span><span class="p">,</span> <span class="s">&quot;http://localhost:8080&quot;</span><span class="p">,</span> <span class="s">&quot;server pool list&quot;</span><span class="p">)</span>
    <span class="nx">flag</span><span class="p">.</span><span class="nx">Parse</span><span class="p">()</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/color&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">color</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">FormValue</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="kd">var</span> <span class="nx">b</span> <span class="p">[]</span><span class="kt">byte</span>
        <span class="nx">err</span> <span class="o">:=</span> <span class="nx">Group</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="nx">color</span><span class="p">,</span> <span class="nx">groupcache</span><span class="p">.</span><span class="nx">AllocatingByteSliceSink</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">b</span><span class="p">))</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusNotFound</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
        <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="kt">byte</span><span class="p">{</span><span class="sc">&#39;\n&#39;</span><span class="p">})</span>
    <span class="p">})</span>
    <span class="nx">p</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="o">*</span><span class="nx">peers</span><span class="p">,</span> <span class="s">&quot;,&quot;</span><span class="p">)</span>
    <span class="nx">pool</span> <span class="o">:=</span> <span class="nx">groupcache</span><span class="p">.</span><span class="nx">NewHTTPPool</span><span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nx">pool</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">p</span><span class="o">...</span><span class="p">)</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="o">*</span><span class="nx">addr</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">EOF</span>
</pre></div>
</td></tr></table>

<p>Let's compile this with <strong>scone-gccgo</strong>:</p>
<div class="codehilite"><pre><span></span><span class="nb">export</span> <span class="nv">SCONE_HEAP</span><span class="o">=</span>1G
go build -compiler gccgo -buildmode<span class="o">=</span>exe -gccgoflags -g groupcache.go
</pre></div>

<p>Run groupcache in the background:</p>
<div class="codehilite"><pre><span></span>./groupcache <span class="p">&amp;</span>
</pre></div>

<p>And let's query groupcache:</p>
<div class="codehilite"><pre><span></span>curl localhost:8080/color?name<span class="o">=</span>green
<span class="c1">#00FF00</span>
curl localhost:8080/color?name<span class="o">=</span>red
<span class="c1">#FF0000</span>
</pre></div>

<h2 id="shielding">Shielding<a class="headerlink" href="#shielding" title="Permanent link">&para;</a></h2>
<p>While the above code runs inside of an enclave, there are multiple security issues if that code would run in an untrusted environment:</p>
<ul>
<li>
<p>The peers communicate via http instead of https. This means that executing in an enclave does not improve the security since an attacker can just look into the network traffic of groupcache.</p>
<ul>
<li>The use of https instead of http would require a certificate and a private key.</li>
</ul>
</li>
<li>
<p>The arguments (i.e., -addr and -pool) are passed via command line, i.e., we can neither trust the integrity nor the confidentiality of these arguments.</p>
</li>
<li>
<p>This <strong>groupcache</strong> service logs error messages on stderr.  </p>
</li>
<li>
<p>How can we be sure if the code runs indeed in an enclave? After all, SCONE supports simulation mode.</p>
</li>
</ul>
<h3 id="alternative-manual-modifications">Alternative: Manual Modifications<a class="headerlink" href="#alternative-manual-modifications" title="Permanent link">&para;</a></h3>
<p>One could manually modify the program to use <em>https</em> instead of <em>http</em>, one could encrypt the output with AES. However, this would require that we have to change <strong>groupcache</strong> not only to encrypt all output but also to manage the key for encrypting the output. </p>
<p>The private key of the certificate is typically stored in an unencrypted file and protected via the access control of the file system. Since we do not trust the operating system, we would need to encrypt the private key in the file system.</p>
<p>We would need to attest the <strong>groupcache</strong> and after successful attestation pass the encryption keys and the arguments to  <strong>groupcache</strong> via a secure channel.</p>
<h3 id="alternative-scone-shielding">Alternative: SCONE shielding<a class="headerlink" href="#alternative-scone-shielding" title="Permanent link">&para;</a></h3>
<p>Many programs would require such or similar changes as <strong>groupcache</strong>. Hence, SCONE provides a way to shield programs without the need to modify these programs.</p>
<p>This main advantages of that approach is that  </p>
<ul>
<li>
<p>one does not have to put in the engineering to modify the code - which is difficult and bug-prone</p>
</li>
<li>
<p>one can easily keep up with upstream code changes without the need to continuously patch the upstream code </p>
</li>
<li>
<p>one does not risk a lock-in by having SGX-specific or SCONE-specific code modifications</p>
</li>
</ul>
<p>We will show in later sections how we can <strong>shield</strong> this application with the help of SCONE such that</p>
<ul>
<li>
<p>no source code changes are necessary, and</p>
</li>
<li>
<p>we only need to define a description what shields should be activated</p>
</li>
</ul>
<p>In this way, we can address all of the above issues that we described.</p>
<p>&copy; <a href="http://www.scontain.com">scontain.com</a>, July 2018. <a href="mailto:info@scontain.com">Questions or Suggestions?</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../dockerfileexample/" title="Dockerfile Example" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Dockerfile Example
              </span>
            </div>
          </a>
        
        
          <a href="../installation/" title="Installation overview" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Installation overview
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.a59e2a89.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>