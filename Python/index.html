<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Python - SCONE</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Python";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-103149717-2', 'sconedocs.github.io');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> SCONE</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <ul class="subnav">
    <li><span>Tutorial</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="..">Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../outline/">Getting Started</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../appsecurity/">Application-oriented security</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../background/">SCONE Background</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_CLI/">SCONE CLI</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_HOST_SETUP/">SCONE Host Setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_toolchain/">SCONE SGX toolchain</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Curated_Images/">SCONE Curated Images</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_TUTORIAL/">SCONE Tutorial</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_GENERATE_IMAGE/">SCONE Create Image</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Dockerfile/">SCONE Dockerfile</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm_Example/">SCONE Swarm Example</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Compose/">SCONE Compose</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_CAS/">SCONE CAS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_EE2EE/">Example E2E encryption</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Language Support</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C/">C</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C++/">C++</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Fortran/">Fortran</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../GO/">GO</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Java/">Java</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Python</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#python">Python</a></li>
                
                    <li><a class="toctree-l4" href="#image">Image</a></li>
                
                    <li><a class="toctree-l4" href="#python-interpreter">Python Interpreter</a></li>
                
                    <li><a class="toctree-l4" href="#running-an-application">Running an application</a></li>
                
                    <li><a class="toctree-l4" href="#numpy">NumPy</a></li>
                
                    <li><a class="toctree-l4" href="#cairo">Cairo</a></li>
                
                    <li><a class="toctree-l4" href="#example">Example</a></li>
                
                    <li><a class="toctree-l4" href="#limitation">Limitation</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Rust/">Rust</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Manuals</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_HOST/">scone host</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_SERVICE/">scone service</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_STACK/">scone stack</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_SWARM/">scone swarm</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_VOLUME/">scone volume</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Fileshield/">scone fspf</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Appendix</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_ENV/">Environment variables</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../MrEnclave/">MrEnclave</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../ssh/">ssh setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../glossary/">Glossary</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Publications/">Publications</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../aboutScone/">About Scone</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">SCONE</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Language Support &raquo;</li>
        
      
    
    <li>Python</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="python">Python</h1>
<p>SCONE supports running Python programs inside of SGX enclaves. To support this, we provide a simple Docker image (you need access rights for that).</p>
<h2 id="image">Image</h2>
<p>Currently, we provde a simple Python 2.7 image that is based on the standard Python image python:2.7-alpine.</p>
<p>You can pull this image as follows:</p>
<pre><code class="bash">&gt; docker pull sconecuratedimages/crosscompilers:python27
</code></pre>

<h2 id="python-interpreter">Python Interpreter</h2>
<p>To run the Python interpreter inside an enclave in interactive mode, just execute:</p>
<pre><code class="bash">&gt; docker run -it -v &quot;$PWD&quot;:/usr/src/myapp -w /usr/src/myapp sconecuratedimages/crosscompilers:python27
export SCONE_QUEUES=4
export SCONE_SLOTS=256
export SCONE_SIGPIPE=0
export SCONE_MMAP32BIT=0
export SCONE_SSPINS=100
export SCONE_SSLEEP=4000
export SCONE_KERNEL=0
export SCONE_HEAP=11000000
export SCONE_CONFIG=/etc/sgx-musl.conf
export SCONE_MODE=hw
export SCONE_SGXBOUNDS=no
export SCONE_ALLOW_DLOPEN=yes
Revision: 9b355b99170ad434010353bb9f4dca24e532b1b7
Branch: master
Configure options: --enable-file-prot --enable-shared --enable-debug --prefix=/scone/src/built/cross-compiler/x86_64-linux-musl

Python 2.7.14 (default, Nov  4 2017, 00:12:32) 
[GCC 5.3.0] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; 
</code></pre>

<h2 id="running-an-application">Running an application</h2>
<p>Say, you have a Python application called <em>myapp.py</em> in your current directory.
To execute this with Pyhton 2.7 inside an enclave, you need to set some environment variables. </p>
<ul>
<li>
<p>To run Python inside of an enclave, you can set the environment variable <strong>SCONE_MODE=HW</strong> and <strong>SCONE_ALPINE=1</strong>.</p>
</li>
<li>
<p>To issue some debug messages that show that we are running inside an enclave, set <strong>SCONE_VERSION=1</strong></p>
</li>
<li>
<p>In general, we only permit the loading of dynamic libraries during the startup of a program - these libraries are part of <strong>MRENCLAVE</strong>, i.e., the hash of the enclave. To enable the loading of dynamic libraries after startup (and without requiring the authentication of this library via the file shield), one can set <strong>SCONE_ALLOW_DLOPEN=2</strong>. For operations, the environment variables are set by the <a href="../SCONE_CAS/">CAS</a> and you must set <strong>SCONE_ALLOW_DLOPEN</strong> either to <strong>SCONE_ALLOW_DLOPEN=1</strong> to enable loading of dynamic libraries or must not define <strong>SCONE_ALLOW_DLOPEN</strong>.</p>
</li>
<li>
<p>Python applications often require large heaps and large stacks. The current SGX CPUs (SGXv1) do not permit to increase the size of enclaves dynamically. This implies that enclaves might run out of memory if the initial enclave size was set to small. Selecting large enclave size by default would result in long startup times for all programs. SCONE permits to set the heap size via environment variable <strong>SCONE_HEAP</strong> and the stack size via <strong>STACK_SIZE</strong> at startup.</p>
</li>
</ul>
<p><strong>Python does not always deal gracefully with out of memory situations: often, it terminates with some misleading error message if Python runs out of heap or stack memory. Please try to give python sufficient stack and heap size if this happens. We recommend to start with a large heap, like, SCONE_HEAP=10000000000 to ensure that Python has sufficient heap. If your program runs without any problem with a large heap, you can try to reduce the heap size to speedup program startup times.</strong></p>
<p>Note that you can set the environment variable of a process - in our case python - running inside a container with docker option <strong>-e</strong>:</p>
<pre><code class="bash">&gt; docker run --rm -v &quot;$PWD&quot;:/usr/src/myapp -w /usr/src/myapp -e SCONE_HEAP=10000000000 SCONE_MODE=HW -e SCONE_ALLOW_DLOPEN=2 -e SCONE_ALPINE=1 -e SCONE_VERSION=1 sconecuratedimages/crosscompilers:python27 python myapp.py

export SCONE_QUEUES=4
export SCONE_SLOTS=256
export SCONE_SIGPIPE=0
export SCONE_MMAP32BIT=0
...
</code></pre>

<h2 id="numpy">NumPy</h2>
<p>Let's see how we can install some extra packages that your python program might need. Let us focus on <strong>NumPy</strong> first, a very popular package for scientific computing. Note that the following steps you would typically perform as part of a <a href="../SCONE_Dockerfile/">Dockerfile</a>.</p>
<p>First, we start the SCONE Python  image:</p>
<pre><code class="bash">&gt; docker run -it sconecuratedimages/crosscompilers:python27 bash
</code></pre>

<p>We then install <strong>numpy</strong> inside of the container with the help of <strong>pip</strong>:</p>
<pre><code class="bash">$ pip install numpy
Collecting numpy
  Downloading numpy-1.14.0.zip (4.9MB)
    100% |████████████████████████████████| 4.9MB 211kB/s 
Building wheels for collected packages: numpy
  Running setup.py bdist_wheel for numpy ... |
done
  Stored in directory: /root/.cache/pip/wheels/1e/02/97/ba1c91fa21d10f8f96cc6ddd7d9553d429b5af17558fb83280
Successfully built numpy
Installing collected packages: numpy
Successfully installed numpy-1.14.0
</code></pre>

<p>Ok, let's try to execute some examples with <strong>NumPy</strong>. Let's  run Python inside an enclave, give it plenty of heap memory and ask SCONE to print some debug messages:</p>
<pre><code class="bash">$ SCONE_HEAP=10000000000 SCONE_ALLOW_DLOPEN=2 SCONE_MODE=AUTO SCONE_ALPINE=1 SCONE_VERSION=1 /usr/local/bin/python
export SCONE_QUEUES=4
export SCONE_SLOTS=256
export SCONE_SIGPIPE=0
export SCONE_MMAP32BIT=0
export SCONE_SSPINS=100
export SCONE_SSLEEP=4000
export SCONE_KERNEL=0
export SCONE_HEAP=10000000000
export SCONE_STACK=0
export SCONE_CONFIG=/etc/sgx-musl.conf
export SCONE_MODE=hw
export SCONE_SGXBOUNDS=no
export SCONE_VARYS=no
export SCONE_ALLOW_DLOPEN=yes
export SCONE_ALLOW_DLOPEN2=yes
Revision: 7950fbd1a699ba15f9382ebaefc3ce0d4090801f
Branch: master (dirty)
Configure options: --enable-shared --enable-debug --prefix=/scone/src/built/cross-compiler/x86_64-linux-musl

Python 2.7.14 (default, Dec 19 2017, 22:29:22) 
[GCC 6.4.0] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; 
</code></pre>

<p>Now, we can import numpy and execute some commands:</p>
<pre><code class="bash">&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; a = np.arange(15).reshape(3, 5)
&gt;&gt;&gt; a
array([[ 0,  1,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, 13, 14]])
&gt;&gt;&gt; a.shape
(3, 5)
&gt;&gt;&gt; a.ndim
2
&gt;&gt;&gt; a.dtype.name
'int64'
&gt;&gt;&gt; a.itemsize
8
&gt;&gt;&gt; type(a)
&lt;type 'numpy.ndarray'&gt;
&gt;&gt;&gt; 
</code></pre>

<h2 id="cairo">Cairo</h2>
<p>Let's look at another popular library: the <strong>cairo</strong> graphics library. <strong>cairo</strong>  is written in C and has 
Python bindings provided by package <strong>pycairo</strong>. In this case, we need to install the C-library first:</p>
<p>In Alpine Linux - which is the basis of the SCONE Python image - we can install cairo as follows:</p>
<pre><code class="bash">$ apk add --no-cache  cairo-dev cairo 
fetch http://dl-cdn.alpinelinux.org/alpine/v3.7/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.7/community/x86_64/APKINDEX.tar.gz
(1/55) Installing expat-dev (2.2.5-r0)
...
(55/55) Installing cairo-dev (1.14.10-r0)
Executing busybox-1.27.2-r6.trigger
Executing glib-2.54.2-r0.trigger
No schema files found: doing nothing.
OK: 297 MiB in 112 packages
$ 
</code></pre>

<p>Now we can install the Python bindings of cairo with <strong>pip</strong>:</p>
<pre><code class="bash">$ pip install pycairo
Collecting pycairo
  Downloading pycairo-1.15.4.tar.gz (178kB)
    100% |████████████████████████████████| 184kB 1.7MB/s 
Building wheels for collected packages: pycairo
  Running setup.py bdist_wheel for pycairo ... done
  Stored in directory: /root/.cache/pip/wheels/99/a6/16/79c5186b0ead4be059ce3102496b1ff776776b31da8e51af8f
Successfully built pycairo
Installing collected packages: pycairo
Successfully installed pycairo-1.15.4
</code></pre>

<p>We can now start Python again via </p>
<pre><code class="bash">SCONE_HEAP=10000000000 SCONE_ALLOW_DLOPEN=2 SCONE_MODE=AUTO SCONE_ALPINE=1 SCONE_VERSION=1 /usr/local/bin/python

</code></pre>

<p>before we execute some cairo examples:</p>
<pre><code class="bash">&gt;&gt;&gt; import cairo
&gt;&gt;&gt; import math
&gt;&gt;&gt; WIDTH, HEIGHT = 256, 256
&gt;&gt;&gt; 
&gt;&gt;&gt; surface = cairo.ImageSurface (cairo.FORMAT_ARGB32, WIDTH, HEIGHT)
&gt;&gt;&gt; ctx = cairo.Context (surface)
&gt;&gt;&gt; ctx.scale (WIDTH, HEIGHT) # Normalizing the canvas
&gt;&gt;&gt; 
&gt;&gt;&gt; pat = cairo.LinearGradient (0.0, 0.0, 0.0, 1.0)
&gt;&gt;&gt; pat.add_color_stop_rgba (1, 0.7, 0, 0, 0.5) # First stop, 50% opacity
&gt;&gt;&gt; pat.add_color_stop_rgba (0, 0.9, 0.7, 0.2, 1) # Last stop, 100% opacity
&gt;&gt;&gt; 
&gt;&gt;&gt; ctx.rectangle (0, 0, 1, 1) # Rectangle(x0, y0, x1, y1)
&gt;&gt;&gt; ctx.set_source (pat)
&gt;&gt;&gt; ctx.fill ()
&gt;&gt;&gt; ctx.translate (0.1, 0.1) # Changing the current transformation matrix
&gt;&gt;&gt; 
&gt;&gt;&gt; ctx.move_to (0, 0)
&gt;&gt;&gt; # Arc(cx, cy, radius, start_angle, stop_angle)
... ctx.arc (0.2, 0.1, 0.1, -math.pi/2, 0)
&gt;&gt;&gt; ctx.line_to (0.5, 0.1) # Line to (x,y)
&gt;&gt;&gt; # Curve(x1, y1, x2, y2, x3, y3)
... ctx.curve_to (0.5, 0.2, 0.5, 0.4, 0.2, 0.8)
&gt;&gt;&gt; ctx.close_path ()
&gt;&gt;&gt; 
&gt;&gt;&gt; ctx.set_source_rgb (0.3, 0.2, 0.5) # Solid color
&gt;&gt;&gt; ctx.set_line_width (0.02)
&gt;&gt;&gt; ctx.stroke ()
&gt;&gt;&gt; surface.write_to_png (&quot;example.png&quot;) # Output to PNG
&gt;&gt;&gt; exit()
</code></pre>

<p>This generates a file <strong>example.png</strong> in the working directory.</p>
<h2 id="example">Example</h2>
<p>Let's look at another example:</p>
<ul>
<li>
<p>We use <em>pip</em> to install a Python chess library.</p>
</li>
<li>
<p>Then we run Python inside of an enclave and  import the chess library. </p>
</li>
<li>
<p>We use the Scholar's mate example from <a href="https://pypi.python.org/pypi/python-chess">https://pypi.python.org/pypi/python-chess</a></p>
</li>
</ul>
<p><a href="https://asciinema.org/a/kcXffCrpfAIjldgvnnSqtiE03"><img alt="asciicast" src="https://asciinema.org/a/kcXffCrpfAIjldgvnnSqtiE03.png" /></a></p>
<h2 id="limitation">Limitation</h2>
<p>We do not yet support fork, i.e., you spawn new processes from within your Python programs. We are currently working on removing this limitation of SCONE. Until then, we expect you to have an external spawner. </p>
<p>&copy; <a href="http://www.scontain.com">scontain.com</a>, January 2018. <a href="mailto:info@scontain.com">Questions or Suggestions?</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Rust/" class="btn btn-neutral float-right" title="Rust"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Java/" class="btn btn-neutral" title="Java"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Java/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Rust/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
