<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCONE SGX toolchain - SCONE</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "SCONE SGX toolchain";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-103149717-2', 'sconedocs.github.io');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> SCONE</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Introduction</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../outline/">Getting Started</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../appsecurity/">Application-oriented security</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../background/">SCONE Background</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_CLI/">SCONE CLI</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_HOSTINSTALLER_README/">SCONE Host Setup</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">SCONE SGX toolchain</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#scone-sgx-toolchain">SCONE SGX Toolchain</a></li>
                
                    <li><a class="toctree-l4" href="#compiler-variants">Compiler variants</a></li>
                
                    <li><a class="toctree-l4" href="#using-the-cross-compiler-container">Using the cross compiler container</a></li>
                
                    <li><a class="toctree-l4" href="#example">Example</a></li>
                
                    <li><a class="toctree-l4" href="#debugger-support">Debugger support</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Curated_Images/">SCONE Curated Images</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_TUTORIAL/">SCONE Tutorial</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_GENERATE_IMAGE/">SCONE Create Image</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Dockerfile/">SCONE Dockerfile</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm/">SCONE Swarm</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm_Example/">SCONE Swarm Example</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Fileshield/">SCONE File Protection</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../Python/">Python</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../GO/">GO</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_ENV/">SCONE Environment variables</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Publications/">SCONE Publications</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../glossary/">Glossary</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../aboutScone/">About Scone</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">SCONE</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>SCONE SGX toolchain</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="scone-sgx-toolchain">SCONE SGX Toolchain</h1>
<p>SCONE comes with compiler support for popular languages: C, C++, GO, Rust as well as Fortran.
The objective of these (cross-) compilers are to compile applications - generally without source code changes - such that they can run inside of SGX enclaves.</p>
<p>To simplify the use of these (cross-) compilers, SCONE maintains curated container image that includes these cross-compilers.</p>
<h2 id="compiler-variants">Compiler variants</h2>
<p>Depending on if you want to generate a <em>dynamically-linked</em> or a <em>statically-linked</em> binary, you
can use a standard compiler (dynamic) or you need to use a cross compiler (static). The compiler can run on any system, i.e., does not require SGX to run. To generate a statically-linked binary, you need to run on a SGX-enabled machine (for now).</p>
<p><strong>Note</strong> Independently, if you use a dynamic or static linking, the hash of an enclave (MRENCLAVE) will encompass the whole code, i.e., includes all libraries. Any updates of a library on your host might prevent the execution of a SCONE binary because of a wrong MRENCLAVE. Hence, we recommend to use only statically-linked programs on the host. In containers, which have a more controlled environment, we support both statically as well as dynamically linked binaries. The main advantage of dynamic linking is that for many programs we do not change the build process when moved to SCONE.</p>
<p><strong>Note</strong> also that SCONE supports the loading of dynamic libraries after a program has already started inside of an enclave. This feature is required by modern languages like Java. Enabling general loading of dynamic library introduces the risk that one could load malicious code inside of an enclave. Hence, we switch this feature off by default. For debugging programs, you can enable this feature via an environment variable (<em>export SCONE_ALLOW_DLOPEN=2).</em> For production enclaves, you will need to protect the integrity of the shared libraries with the help of the <a href="../SCONE_Fileshield/">SCONE file shield</a>.</p>
<h3 id="dynamically-linked-binaries">Dynamically-Linked Binaries</h3>
<p>The easiest to get started is to compile your programs such that</p>
<ul>
<li>
<p>the generated code is position independent (<em>-fPIC</em>),</p>
</li>
<li>
<p>the thread local storage model is global-dynamic (<em>-ftls-model=global-dynamic</em>),</p>
</li>
<li>
<p>your binary is dynamically linked (i.e., do not use <em>-static</em>), and</p>
</li>
<li>
<p>link against musl as your libc (i.e., not glibc or any other libc).</p>
</li>
</ul>
<p><img alt="Dynamic Compilation" src="../img/dynamiccompilation.png" /></p>
<p>When a program is started, SCONE uses its own dynamic link loader to replace libc by a SCONE libc. The SCONE dynamic linker will load the program inside a new SGX enclave and SCONE libc will enable programs to run inside the SGX enclaves, e.g., execute system calls and protect them from attacks via shields like the <a href="../SCONE_Fileshield/">file system shield</a>.</p>
<p>To simplify the compiling of your programs for scone, we make available a docker image <em>sconecuratedimages/muslgcc</em> which includes <em>gcc</em> and <em>g++</em> support. The options will by default be set as shown above. You need, however, to make sure that your Makefiles will not overwrite these options.</p>
<h3 id="statically-linked-binaries">Statically-Linked Binaries</h3>
<p>For statically linked binaries, we make available a (private) docker image <em>sconecuratedimages/crosscompilers:scone</em> which can produce statically linked binaries. In the statically linked binaries, we replace the interface to the operating system (i.e., libc) by a variant that enables programs to run inside Intel SGX enclaves.</p>
<p><img alt="Static Compilation" src="../img/staticcompilation.jpg" /></p>
<p>Note that a statically linked binaries might look like a dynamically-linked binary. For example, if you look at a statically-linked program <em>web-srv-go</em>, you will still see dynamic dependencies:</p>
<pre><code class="bash">ldd web-srv-go 
    linux-vdso.so.1 =&gt;  (0x00007ffe423fd000)
    libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007effa344f000)
    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007effa3085000)
    /lib64/ld-linux-x86-64.so.2 (0x00007effa366c000)
</code></pre>

<p>The reason for that is that the statically linked binary that runs inside of an enclave is wrapped in a dynamically linked <em>loader</em> program. The loader program creates the enclave, moves the program code inside the enclave and starts threads that will enter the enclave. The code that is moved inside the enclave is, however, statically linked.</p>
<h2 id="using-the-cross-compiler-container">Using the cross compiler container</h2>
<p>How to use the compiler:</p>
<ul>
<li>
<p>use this as a base image and build your programs inside of a container we a  <a href="../SCONE_Dockerfile/">Dockerfile</a>), or</p>
</li>
<li>
<p>map volumes such that the compiler can compile files living outside the container (see <a href="../SCONE_TUTORIAL/">SCONE Tutorial</a>).</p>
</li>
</ul>
<p>For an example how to use the crosscompilers, see how to compile a programs written in <a href="../GO/">GO</a>.</p>
<h2 id="example">Example</h2>
<p><strong>Note</strong>  on some systems you will need to run <em>docker</em> with root permissions, i.e., in this case you should prefix a </p>
<pre><code class="bash">docker ...
</code></pre>

<p>command with <em>sudo</em>, i.e., you execute </p>
<pre><code class="bash">sudo docker ...
</code></pre>

<p>One can run the above compiler inside of a container while the compiled files reside outside the container. Say, your code is
in file <em>myapp.c</em> in your current directory (<em>$PWD</em>). You can compile this code as follows:</p>
<pre><code class="bash">docker run --rm  -v &quot;$PWD&quot;:/usr/src/myapp -w /usr/src/myapp sconecuratedimages/muslgcc gcc myapp.c
</code></pre>

<p>This call will generate a binary <em>a.out</em> in your working directory. This binary is dynamically linked against musl:</p>
<pre><code class="bash"># ldd a.out 
    /lib/ld-musl-x86_64.so.1 (0x7fb0379f9000)
    libc.musl-x86_64.so.1 =&gt; /lib/ld-musl-x86_64.so.1 (0x7fb0379f9000)
</code></pre>

<p>This binary can run natively only if you have musl installed at the correct position in your development machine (and your development machine runs Linux). Alternatively, you can run the binary in a container:</p>
<pre><code class="bash">docker run --rm  -v &quot;$PWD&quot;:/usr/src/myapp -w /usr/src/myapp sconecuratedimages/muslgcc ./a.out
</code></pre>

<p>To run this inside of SGX enclaves with SCONE, you need access to the SCONE runtime systems. For more details, see our <em>hello world</em> in Section <a href="../SCONE_TUTORIAL/">SCONE Tutorial</a>. This is not very convenient and hence, we provide a) a simpler version with the help of <a href="../SCONE_Dockerfile/">Dockerfiles</a>. </p>
<p>In most cases, you might just set to use one of our crosscompilers in your <em>configure</em> script or <em>Makefile</em>. A simple way is to use the Docker image <em>sconecuratedimages/crosscompilers:scone</em> as a base image and then clone your code inside the container and set one or more of our compilers (<em>scone-gcc, scone-g++, scone-gccgo, scone-gfortran, and scone-rustc</em>) to be used in your build. For Rust, we support also our variant of <em>cargo</em> which is <em>scone-cargo</em>.</p>
<h2 id="debugger-support">Debugger support</h2>
<p>We also support <em>gdb</em> to debug applications running inside of enclaves. To get started, we recommend that you first ensure that your program runs natively linked against musl. Most programs will do - after all, the Alpine Linux distribution is completely based on musl. The debugger is available in image <em>sconecuratedimages/crosscompilers:scone</em> as <em>scone-gdb</em>.</p>
<p>For example on how to use the debugger, see how to debug a program written in  <a href="../GO/">GO</a>.</p>
<p>&copy; <a href="http://www.scontain.com">scontain.com</a>, November 2017. <a href="mailto:info@scontain.com">Questions or Suggestions?</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../SCONE_Curated_Images/" class="btn btn-neutral float-right" title="SCONE Curated Images"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../SCONE_HOSTINSTALLER_README/" class="btn btn-neutral" title="SCONE Host Setup"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../SCONE_HOSTINSTALLER_README/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../SCONE_Curated_Images/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
