<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCONE Host Setup - SCONE</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "SCONE Host Setup";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> SCONE</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Introduction</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../outline/">Outline</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../appsecurity/">Application-oriented security</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../background/">SCONE Background</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_CLI/">SCONE CLI</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">SCONE Host Setup</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#scone-host-installation-guide">SCONE: Host Installation Guide</a></li>
                
                    <li><a class="toctree-l4" href="#ssh">SSH</a></li>
                
                    <li><a class="toctree-l4" href="#installation-of-a-single-host">Installation of a single host</a></li>
                
                    <li><a class="toctree-l4" href="#installation-of-a-swarm">Installation of a swarm</a></li>
                
                    <li><a class="toctree-l4" href="#background-information">Background Information</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_COMPILER_CONTAINER_README/">SCONE SGX toolchain</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Curated_Images/">SCONE Curated Images</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_TUTORIAL/">SCONE Tutorial</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_GENERATE_IMAGE/">SCONE Create Image</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Dockerfile/">SCONE Dockerfile</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm/">SCONE Swarm</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm_Example/">SCONE Swarm Example</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Publications/">SCONE Publications</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../glossary/">Glossary</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">SCONE</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>SCONE Host Setup</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="scone-host-installation-guide">SCONE: Host Installation Guide</h1>
<p>This page describes how</p>
<ul>
<li>
<p>to set up a host such that it can run SCONE secure containers, i.e., containers in which processes run inside of SGX enclaves, and</p>
</li>
<li>
<p>we remind you of how to set up your <em>ssh</em> configuration to be able to use your scone CLI.</p>
</li>
</ul>
<p>During this setup, we</p>
<ul>
<li>
<p>install a <em>patched</em> Intel SGX driver - required for better monitoring support,</p>
</li>
<li>
<p>install a <em>patched</em> docker engine - to ensure that all containers have access to SGX, and</p>
</li>
<li>
<p>start or join a docker swarm - if requested by command line options.</p>
</li>
</ul>
<p><strong>Prerequisite</strong>:
We assume that you have set up the <strong>scone</strong> <a href="../SCONE_CLI/">command line interface</a>.
The <em>scone</em> CLI can run on your developer machine, a virtual machine or inside a container.
The easiest way to get started is to run <em>scone</em> in a Docker container.
No matter where <em>scone</em> is running, it requires that <em>ssh</em> be properly installed.</p>
<p><strong>NOTE</strong> This host setup will enable the execution of <em>SCONE secure containers</em> on SGX-enabled machines. These containers can run one or more <em>secure programs</em>, i.e., programs that are executed inside SGX enclaves.   The secure programs of secure containers can be statically-linked or dynamically-linked (see <a href="../SCONE_COMPILER_CONTAINER_README/">SCONE SGX Toolchain</a>). The host itself runs statically-linked secure programs only - this is to avoid failures do to library versioning issues.</p>
<h2 id="ssh">SSH</h2>
<p>The <em>scone</em> utility executes commands via <em>ssh</em> on the SGX-capable machine that should be installed.</p>
<p><img alt="SCONE Installation Alternatives" src="../img/alternativeInstallationMethods.png" /></p>
<p>Since we potentially execute many <em>ssh</em> commands, you need to configure <em>ssh</em> such that</p>
<ul>
<li>
<p>you can log into the SGX machines <em>without</em>  having to type a password, </p>
</li>
<li>
<p>you can use the basename of your SGX machines to log in , and</p>
</li>
<li>
<p>ssh is permitted to reuse connections to reduce the execution time of the <em>scone</em> commands.</p>
</li>
</ul>
<h3 id="passwordless-ssh">Passwordless ssh</h3>
<p>To set up passwordless ssh authentication, you need to ensure that you have a pair of authentication keys. If there exists no public key <em>$HOME/.ssh/id_rsa.pub</em> (often the case if you use a container), you can generate a new pair by executing:</p>
<pre><code class="bash">ssh-keygen -b 4096 -t rsa
</code></pre>

<p>Append the generated public key <em>$HOME/.ssh/id_rsa.pub</em> to file <em>$HOME/.ssh/authorized_keys</em> on the SGX hosts for which you to be able to log in without a password.</p>
<p>Additionally, you need to start a ssh-agent (on your developer machine):</p>
<pre><code class="bash">SA=`ssh-agent`
eval &quot;$SA&quot;
</code></pre>

<p>and add your authentication keys by executing:</p>
<pre><code class="bash">ssh-add
</code></pre>

<h3 id="host-alias">Host alias</h3>
<p>To reduce your typing overhead, you can use the basename of a host - if you configure ssh appropriately. For example, instead of typing <em>node2.my.very.long.domain.com</em>, you could configure  <em>ssh</em> such that <em>node2</em> refers to <em>node2.my.very.long.domain.com</em>.</p>
<p>As a caveat, this basename must be sufficient for other hosts in the <em>same swarm</em> to reach <em>node2</em>. In the above figure, <em>manager</em> must be able to resolve <em>node2</em> to the IP address of <em>node2.my.very.long.domain.com</em>.</p>
<p>To add an alias for <em>node2.my.very.long.domain.com</em>, you could add the following lines to your <em>ssh config</em> (stored in <em>$HOME/.ssh/config</em>):</p>
<pre><code class="bash">Host node2
     HostName node2.my.very.long.domain.com
     Port 22
     User scone
     IdentityFile ~/.ssh/id_rsa
</code></pre>

<h3 id="ssh-connection-reuse">ssh connection reuse</h3>
<p>To be able to reuse a ssh connection, you must configure ssh appropriately. You should set <em>ControlMaster</em> to <em>auto</em> and you have to specify a control path via option <em>ControlPath</em>. You can define a generic path like <em>~/.ssh/ssh_mux_%h_%p_%r</em> - this can be the same for all hosts. For example, for some host <em>alice</em> you might add the following lines to <em>$HOME/.ssh/config</em>:</p>
<pre><code class="bash">Host alice
        ControlMaster auto
        ControlPath ~/.ssh/ssh_mux_%h_%p_%r
        user ubuntu
        port 10101
        hostname sshproxy.cloudprovider.com
</code></pre>

<h2 id="installation-of-a-single-host">Installation of a single host</h2>
<p>After you set up the <a href="../SCONE_CLI/">scone CLI</a> and your passwordless ssh works, you can install the scone related software on a new host, say, <em>alice</em> as follows:</p>
<pre><code class="bash">scone host install --name alice
</code></pre>

<p>To verify that a host is properly installed for SCONE and contains the newest patched Docker engine and SGX driver, just execute:</p>
<pre><code class="bash">scone host check --name alice
</code></pre>

<p>This command will issue an error unless the newest versions of the patched Docker engine and the patched SGX driver is installed.</p>
<h2 id="installation-of-a-swarm">Installation of a swarm</h2>
<p>For a set of hosts to form a (Docker) swarm, you need to decide which hosts should be managers and which should be just members of the swarm. Say, you decided that <em>alice</em> and <em>bob</em> should be managers but <em>caroline</em> a non-manager, execute the following:</p>
<pre><code class="bash">scone host install --name alice --as-manager
scone host install --name bob --as-manager --join alice
scone host install --name caroline  --join alice
</code></pre>

<p>Note that the hosts must be able to communicate with each other (i.e., not partitioned through firewalls). Docker recommends/expects  that they will be in the same local area network.</p>
<h4 id="checking-your-installation">Checking your Installation</h4>
<p>To test the installation, one can run a simple hello-world container:</p>
<pre><code class="bash">sudo docker run hello-world
</code></pre>

<h2 id="background-information">Background Information</h2>
<h3 id="patched-docker-engine-moby">Patched Docker Engine (Moby)</h3>
<p>For an container to be able to use SGX, it has to have access to a device (/dev/isgx). This device permits the container to talk to the SGX driver. This driver is needed, in particular, to create SGX enclaves. </p>
<p>Some docker commands (like <em>docker run</em>) support an option --device (i.e., <em>--device /dev/isgx</em>) which allows us to give a container access to the SGX device. We need to point out that some docker commands (like <em>docker build</em>) do, however, not yet support the device option. Therefore, we maintain and install a slightly patched docker engine (i.e., a variant of moby): this engine ensures that each container has access to the SGX device (/dev/isgx).  With the help of this patched engine, we can use Dockerfiles to generate container images (see this <a href="../SCONE_Dockerfile/">Tutorial</a>).</p>
<p>Right now we provide a patched version of the currently active branch of Moby (a.k.a., the Docker engine): 17.06.0-dev, build f9a45b7</p>
<h3 id="patched-sgx-driver">Patched SGX Driver</h3>
<p>We also maintain a patched version of the SGX driver. This version adds some additional monitoring like the number of <em>available</em> and <em>free</em> EPC (Extended Page Cache) pages.</p>
<p>Right now, we provide a patched version of the latest Intel SGX driver from August 3, 2017 (commit cd516380e5ffa008505dc0e86ddbf45276021219).</p>
<p>Author: Christof Fetzer, October 2017</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../SCONE_COMPILER_CONTAINER_README/" class="btn btn-neutral float-right" title="SCONE SGX toolchain"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../SCONE_CLI/" class="btn btn-neutral" title="SCONE CLI"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../SCONE_CLI/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../SCONE_COMPILER_CONTAINER_README/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
