<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCONE Host Setup - SCONE</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "SCONE Host Setup";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> SCONE</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Introduction</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../outline/">Outline</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../appsecurity/">Application-oriented security</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../background/">SCONE Background</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_CLI/">SCONE CLI</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">SCONE Host Setup</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#scone-host-installation-guide">SCONE: Host Installation Guide</a></li>
                
                    <li><a class="toctree-l4" href="#alternative-installation-methods">Alternative Installation Methods</a></li>
                
                    <li><a class="toctree-l4" href="#patched-docker-engine-moby">Patched Docker Engine (Moby)</a></li>
                
                    <li><a class="toctree-l4" href="#patched-sgx-driver">Patched SGX Driver</a></li>
                
                    <li><a class="toctree-l4" href="#installation-of-a-single-host">Installation of a single host</a></li>
                
                    <li><a class="toctree-l4" href="#installation-of-a-swarm">Installation of a swarm</a></li>
                
                    <li><a class="toctree-l4" href="#manual-installation-deprecated">Manual Installation (deprecated)</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_COMPILER_CONTAINER_README/">SCONE SGX toolchain</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Curated_Images/">SCONE Curated Images</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_TUTORIAL/">SCONE Tutorial</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_GENERATE_IMAGE/">SCONE Create Image</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Dockerfile/">SCONE Dockerfile</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm/">SCONE Swarm</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm_Example/">SCONE Swarm Example</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Compose/">SCONE Compose</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_OpenStack/">SCONE OpenStack Support</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Publications/">SCONE Publications</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">SCONE</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>SCONE Host Setup</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="scone-host-installation-guide">SCONE: Host Installation Guide</h1>
<p>This page describes how </p>
<ul>
<li>to set up a host such that it can run SCONE secure containers, i.e., containers in which processes run inside of SGX enclaves,</li>
</ul>
<p>The installation script</p>
<ul>
<li>
<p>installs a <em>patched</em> Intel SGX driver,</p>
</li>
<li>
<p>installs a <em>patched</em> docker engine, and</p>
</li>
<li>
<p>starts/joins a docker swarm - if requested by command line options.</p>
</li>
</ul>
<p><strong>Prerequisite</strong>:  We assume that you have already Ubuntu 16.04LTS (or later) installed on the host.</p>
<h2 id="alternative-installation-methods">Alternative Installation Methods</h2>
<p>The easiest alternative to prepare a host for the use of SCONE is to use the  <strong>scone</strong> <a href="../SCONE_CLI/">command line interface</a>. <em>scone</em> is executed on the developer machine but requires that ssh to the host is already running.</p>
<p>An alternative is to clone a publicrepository that contains scripts to install a host. </p>
<p>We describe the details of both alternative installation methods below.</p>
<p><img alt="SCONE Installation Alternatives" src="../img/alternativeInstallationMethods.png" /></p>
<h2 id="patched-docker-engine-moby">Patched Docker Engine (Moby)</h2>
<p>For an container to be able to use SGX, it has to have access to a device (/dev/isgx). This device permits the container to talk to the SGX driver. This driver is needed, for example, to create SGX enclaves. </p>
<p>Some docker commands (like <em>docker run</em>) support an option --device (i.e., <em>--device /dev/isgx</em>) which allows us to give a container access to the SGX device. We need to point out that some docker commands (like <em>docker build</em>) do, however, not yet support the device option. Therefore, we maintain and install a slightly patched docker engine (i.e., a variant of moby): this engine ensures that each container has access to the SGX device (/dev/isgx).  With the help of this patched engine, we can use Dockerfiles to generate container images (see this <a href="../SCONE_Dockerfile/">Tutorial</a>).</p>
<p>Right now we provide a patched version of the currently active branch of Moby (a.k.a., the Docker engine): 17.06.0-dev, build f9a45b7</p>
<h2 id="patched-sgx-driver">Patched SGX Driver</h2>
<p>We also maintain a patched version of the SGX driver. This version adds some additional monitoring like the number of <em>available</em> and <em>free</em> EPC (Extended Page Cache) pages.</p>
<p>Right now, we provide a patched version of the latest Intel SGX driver from August 3, 2017 (commit cd516380e5ffa008505dc0e86ddbf45276021219).</p>
<h2 id="installation-of-a-single-host">Installation of a single host</h2>
<p>The recommended way to install the necessary software to run Scone, is to install the <a href="../SCONE_CLI/">scone CLI</a> first. With the <em>scone</em> utility, you can install a new host, say, <em>alice</em> as follows:</p>
<pre><code class="bash">scone host install --name alice
</code></pre>

<p>This assumes that you have ssh connectivity to host alice. Typically, you would need an entry for <em>alice</em> in your ssh config (see <a href="../SCONE_CLI/">scone CLI</a> for details).</p>
<p>To verify that a host is properly installed for SCONE and contains the newest patched Docker engine and SGX driver, just execute:</p>
<pre><code class="bash">scone host check --name alice
</code></pre>

<p>This command will issue an error unless the newest versions of the patched Docker engine and the patched SGX driver is installed.</p>
<h2 id="installation-of-a-swarm">Installation of a swarm</h2>
<p>For a set of hosts to form a (Docker) swarm, you need to decide which hosts should be managers and which should be just members of the swarm. Say, you decided that <em>alice</em> and <em>bob</em> should be managers but <em>caroline</em> a non-manager, execute the following:</p>
<pre><code class="bash">scone host install --name alice --as-manager
scone host install --name bob --as-manager --join alice
scone host install --name caroline  --join alice
</code></pre>

<p>Note that the hosts must be able to communicate with each other (i.e., not partitioned through firewalls). Docker recommends/expects  that they will be in the same local area network.</p>
<h2 id="manual-installation-deprecated">Manual Installation (deprecated)</h2>
<pre><code class="bash">git clone https://github.com/christoffetzer/SCONE_HOSTINSTALLER.git
</code></pre>

<p>ensure that you are permitted to execute sudo and execute the following command:</p>
<pre><code class="bash">cd SCONE_HOSTINSTALLER
</code></pre>

<p>In case you have already a docker engine installed, executing the
<strong>installation script will remove the installed docker engine first.</strong></p>
<h4 id="installing-the-swarm-manager">Installing the Swarm Manager</h4>
<p>Each Docker Swarm requires at least one manager. The installation script
can set up the first manager via:</p>
<pre><code class="bash">./install.sh --manager
</code></pre>

<p>The IP address of this manager is used for the nodes of the swarm to find each other. The above script will output how to install other nodes and 'OK' on success:</p>
<pre><code class="bash"># to install another machine and add as a manager, execute
./install.sh --token SWMTKN-1-2f98skv0z2vdhnyw9liwbqtgocts6comdr81o6e3u6kd9olbrc-48zv9ho4f3poid4d34767nucj 192.168.4.101:2377
# to install another machine and add as worker, execute
./install.sh --token SWMTKN-1-2f98skv0z2vdhnyw9liwbqtgocts6comdr81o6e3u6kd9olbrc-91z9bxu0exqli87elwasyjj5w 192.168.4.101:2377
OK
</code></pre>

<p>If you do not remember the tokens, you can output the token by executing the following script (on a manager node):</p>
<pre><code class="bash">./show-tokens.sh 
</code></pre>

<h4 id="installing-a-swarm-worker">Installing a Swarm Worker</h4>
<p>To install a new worker node, execute something like this (use the correct worker token - which is printed during the master installation):</p>
<pre><code class="bash">./install.sh --token SWMTKN-1-2f98skv0z2vdhnyw9liwbqtgocts6comdr81o6e3u6kd9olbrc-91z9bxu0exqli87elwasyjj5w 192.168.4.101:2377
</code></pre>

<h4 id="installing-another-manager-node">Installing another Manager Node</h4>
<p>In a small installation, we might only have one manager. However, in
larger installation it makes sense to have 3 or 5 manager nodes.
To install a new manager node, execute something like this (use the manager token):</p>
<pre><code class="bash">./install.sh --token SWMTKN-1-2f98skv0z2vdhnyw9liwbqtgocts6comdr81o6e3u6kd9olbrc-48zv9ho4f3poid4d34767nucj 192.168.4.101:2377
</code></pre>

<p>The install.sh script outputs 'OK' on success.</p>
<h4 id="checking-your-installation">Checking your Installation</h4>
<p>To test the installation, one can run a simple hello-world container:</p>
<pre><code class="bash">sudo docker run hello-world
</code></pre>

<p>Author: Christof Fetzer, 2017</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../SCONE_COMPILER_CONTAINER_README/" class="btn btn-neutral float-right" title="SCONE SGX toolchain"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../SCONE_CLI/" class="btn btn-neutral" title="SCONE CLI"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../SCONE_CLI/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../SCONE_COMPILER_CONTAINER_README/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
