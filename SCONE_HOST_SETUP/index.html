<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCONE Host Setup - SCONE</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "SCONE Host Setup";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-103149717-2', 'sconedocs.github.io');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> SCONE</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <ul class="subnav">
    <li><span>Tutorial</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="..">Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../outline/">Getting Started</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../appsecurity/">Application-oriented security</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../background/">SCONE Background</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_CLI/">SCONE CLI</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">SCONE Host Setup</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#scone-host-installation-guide">SCONE: Host Installation Guide</a></li>
                
                    <li><a class="toctree-l4" href="#notes">Notes</a></li>
                
                    <li><a class="toctree-l4" href="#installation-of-a-single-host">Installation of a single host</a></li>
                
                    <li><a class="toctree-l4" href="#installation-of-a-swarm">Installation of a swarm</a></li>
                
                    <li><a class="toctree-l4" href="#background-information">Background Information</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_toolchain/">SCONE SGX toolchain</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Curated_Images/">SCONE Curated Images</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_TUTORIAL/">SCONE Tutorial</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_GENERATE_IMAGE/">SCONE Create Image</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Dockerfile/">SCONE Dockerfile</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm_Example/">SCONE Swarm Example</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Compose/">SCONE Compose</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_CAS/">SCONE CAS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_EE2EE/">Example E2E encryption</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Language Support</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C/">C</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C++/">C++</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Fortran/">Fortran</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../GO/">GO</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Java/">Java</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Python/">Python</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Nodejs/">Node</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Rust/">Rust</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Manuals</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_HOST/">scone host</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_SERVICE/">scone service</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_STACK/">scone stack</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_SWARM/">scone swarm</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_VOLUME/">scone volume</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Fileshield/">scone fspf</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Appendix</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_ENV/">Environment variables</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../MrEnclave/">MrEnclave</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../ssh/">ssh setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../glossary/">Glossary</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Publications/">Publications</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../aboutScone/">About Scone</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../news/">News</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">SCONE</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorial &raquo;</li>
        
      
    
    <li>SCONE Host Setup</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="scone-host-installation-guide">SCONE: Host Installation Guide</h1>
<p>This page describes how</p>
<ul>
<li>
<p>to set up a host such that it can run SCONE secure containers, i.e., containers in which processes run inside of SGX enclaves, and</p>
</li>
<li>
<p>we remind you of how to set up your <em>ssh</em> configuration to be able to use your scone CLI.</p>
</li>
</ul>
<p>During this setup, we</p>
<ul>
<li>
<p>install a <em>patched</em> Intel SGX driver - required for better monitoring support,</p>
</li>
<li>
<p>install a <em>patched</em> docker engine - to ensure that all containers have access to SGX, and</p>
</li>
<li>
<p>start or join a docker swarm - if requested by command line options.</p>
</li>
</ul>
<p><strong>Prerequisite</strong>:</p>
<ul>
<li>
<p>We assume that you have set up the <strong>scone</strong> <a href="../SCONE_CLI/">command line interface</a>.
The <em>scone</em> CLI can run on your developer machine, a virtual machine or inside a container.
The easiest way to get started is to run <em>scone</em> in a Docker container.
No matter where <em>scone</em> is running, it requires that <em>ssh</em> be properly installed.</p>
</li>
<li>
<p>We recommend to install Ubuntu 16.04 LTS, Ubuntu 17.10 or Ubuntu 18.04 LTS (as soon as it becomes available) on the Swarm machines. For older versions of Ubuntu, some minor manual fixing might be needed during installation of the SGX drivers and the Docker engine. The screencast below shows some of the issues one faces on older Ubuntu versions. The secure containers are mostly based on Ubuntu or Alpine Linux (smaller image size).</p>
</li>
</ul>
<h2 id="notes">Notes</h2>
<ul>
<li>This host setup will enable the execution of <em>SCONE secure containers</em> on SGX-enabled machines. These containers can run one or more <em>secure programs</em>, i.e., programs that are executed inside SGX enclaves.   The secure programs of secure containers can be statically-linked or dynamically-linked (see <a href="../SCONE_toolchain/">SCONE SGX Toolchain</a>). The host itself runs statically-linked secure programs only - this is to avoid failures do to library versioning issues.</li>
</ul>
<p><em>The <strong>scone CLI</strong> uses </em>ssh<em> to log into remote hosts. We assume that </em>ssh* is setup in such a way that you do not need passwords to log into these hosts.  Please read section <a href="../ssh/">ssh setup</a> to learn how to ensure this.</p>
<h2 id="installation-of-a-single-host">Installation of a single host</h2>
<p>After you set up the <a href="../SCONE_CLI/">scone CLI</a> and your passwordless ssh works, you can install the scone related software on a new host, say, <em>alice</em> as follows:</p>
<pre><code class="bash">$ scone host install --name alice
</code></pre>

<p>To verify that a host is properly installed for SCONE and contains the newest patched Docker engine and SGX driver, just execute:</p>
<pre><code class="bash">$ scone host check --name alice
</code></pre>

<p>This command will issue an error unless the newest versions of the patched Docker engine and the patched SGX driver is installed.</p>
<h2 id="installation-of-a-swarm">Installation of a swarm</h2>
<p>For a set of hosts to form a (Docker) swarm, you need to decide which hosts should be managers and which should be just members of the swarm. Say, you decided that <em>alice</em> and <em>bob</em> should be managers but <em>caroline</em> a non-manager, execute the following:</p>
<pre><code class="bash">$ scone host install --name alice --as-manager
$ scone host install --name bob --as-manager --join alice
$ scone host install --name caroline  --join alice
</code></pre>

<p>Note that the hosts must be able to communicate with each other (i.e., not partitioned through firewalls). Docker recommends/expects  that they will be in the same local area network.</p>
<h4 id="checking-your-installation">Checking your Installation</h4>
<p>To test the installation, one can run a simple hello-world container:</p>
<pre><code class="bash">&gt; sudo docker run hello-world
</code></pre>

<h2 id="background-information">Background Information</h2>
<h3 id="patched-docker-engine-moby">Patched Docker Engine (Moby)</h3>
<p>For an container to be able to use SGX, it has to have access to a device (/dev/isgx). This device permits the container to talk to the SGX driver. This driver is needed, in particular, to create SGX enclaves. </p>
<p>Some docker commands (like <em>docker run</em>) support an option --device (i.e., <em>--device /dev/isgx</em>) which allows us to give a container access to the SGX device. We need to point out that some docker commands (like <em>docker build</em>) do, however, not yet support the device option. Therefore, we maintain and install a slightly patched docker engine (i.e., a variant of moby): this engine ensures that each container has access to the SGX device (/dev/isgx).  With the help of this patched engine, we can use Dockerfiles to generate container images (see this <a href="../SCONE_Dockerfile/">Tutorial</a>).</p>
<p>Right now we provide a patched version of the currently active branch of Moby (a.k.a., the Docker engine): 17.05.0-ce, build 89658be (November 11, 2017).</p>
<h3 id="patched-sgx-driver">Patched SGX Driver</h3>
<p>We also maintain a patched version of the SGX driver. This version adds some additional monitoring like the number of <em>available</em> and <em>free</em> EPC (Extended Page Cache) pages.</p>
<p>Right now, we provide a patched version of the latest Intel SGX driver (November 11, 2017).</p>
<h3 id="note">Note</h3>
<p>We have been updating SCONE such that SCONE does not need access to <strong>/dev/isgx</strong> during cross-compilation - which could, for example, be executed during <em>docker build</em>. Hence, we will soon switch to an unpatched Docker engine and SGX driver.</p>
<h3 id="screencast">Screencast</h3>
<p>This screencast shows the installation of three machines SGX-capable hosts. In this screencast, we show the installation on machines that run older versions of Ubuntu (sgx2 = 14.04, sgx3 = 14.04 with custom kernel, and sgx4 = 16.04). In this case, we will see some warnings since <em>scone host</em> depends on <em>systemd</em> to start the swarm. In case <em>systemd</em> is not available, <em>scone host</em> will still be able to install the patched SGX driver and the patched Docker engine.</p>
<p>Another issue that one sometimes faces is that an older SGX drivers is already installed but cannot be offloaded and replaced by the patched driver by <em>scone host</em>. The reason for that is that typically that some process is still using the <em>/dev/isgx</em> device. This needs to be manually fixed by stopping the process or by rebooting the machine. Alternatively, one can use the existing SGX driver. However, the monitoring of the used EPC pages will not be provided in this case.</p>
<p><a href="https://asciinema.org/a/CixThoNCAciq132ZAwSZ8kZ22"><img alt="asciicast" src="https://asciinema.org/a/CixThoNCAciq132ZAwSZ8kZ22.png" /></a></p>
<p>&copy; <a href="http://www.scontain.com">scontain.com</a>, November 2017. <a href="mailto:info@scontain.com">Questions or Suggestions?</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../SCONE_toolchain/" class="btn btn-neutral float-right" title="SCONE SGX toolchain"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../SCONE_CLI/" class="btn btn-neutral" title="SCONE CLI"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../SCONE_CLI/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../SCONE_toolchain/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
