<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCONE Compose - SCONE</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "SCONE Compose";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> SCONE</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Introduction</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../outline/">Outline</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../appsecurity/">Application-oriented security</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../background/">SCONE Background</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_CLI/">SCONE CLI</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_HOSTINSTALLER_README/">SCONE Host Setup</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_COMPILER_CONTAINER_README/">SCONE SGX toolchain</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Curated_Images/">SCONE Curated Images</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_TUTORIAL/">SCONE Tutorial</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_GENERATE_IMAGE/">SCONE Create Image</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Dockerfile/">SCONE Dockerfile</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm/">SCONE Swarm</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm_Example/">SCONE Swarm Example</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">SCONE Compose</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#scone-stack">SCONE stack</a></li>
                
                    <li><a class="toctree-l4" href="#confidentiality-and-integrity">Confidentiality and Integrity</a></li>
                
                    <li><a class="toctree-l4" href="#image-required">image (required)</a></li>
                
                    <li><a class="toctree-l4" href="#devices">devices</a></li>
                
                    <li><a class="toctree-l4" href="#environment">environment</a></li>
                
                    <li><a class="toctree-l4" href="#pid">pid</a></li>
                
                    <li><a class="toctree-l4" href="#enclave-tmpfs">enclave-tmpfs</a></li>
                
                    <li><a class="toctree-l4" href="#enclave-env_file">enclave-env_file</a></li>
                
                    <li><a class="toctree-l4" href="#enclave-extra_hosts">enclave-extra_hosts:</a></li>
                
                    <li><a class="toctree-l4" href="#file-protection">file-protection</a></li>
                
                    <li><a class="toctree-l4" href="#secure-file-inject">secure-file-inject</a></li>
                
                    <li><a class="toctree-l4" href="#image">image</a></li>
                
                    <li><a class="toctree-l4" href="#tty">tty</a></li>
                
                    <li><a class="toctree-l4" href="#stdin_open">stdin_open</a></li>
                
                    <li><a class="toctree-l4" href="#file-encryption">file-encryption</a></li>
                
                    <li><a class="toctree-l4" href="#socket-encryption">socket-encryption</a></li>
                
                    <li><a class="toctree-l4" href="#lease-management">lease management</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_OpenStack/">SCONE OpenStack Support</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Publications/">SCONE Publications</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">SCONE</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>SCONE Compose</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="scone-stack">SCONE stack</h1>
<p><strong> NOTE: THIS FUNCTIONALITY WILL ONLY BECOME AVAILABLE FOR EVALUATION IN LATE 2017. The interface is still subject to change. </strong></p>
<p>Note that we decided to extend Docker stack file instead of a Docker compose file. One reason is that Docker stack supports device mappings while new compose files (v3) do not support this anymore.</p>
<p>SCONE implements extensions of the standard Docker stack file <a href="https://docs.docker.com/docker-cloud/apps/stack-yaml-reference/">[reference]</a>. A stack file is a YAML file that is used to build <em>stack</em>, i.e., an application consisting of a collection of containers. The main objective of the SCONE extensions is to enable stacks consisting of secure and standard containers. To secure containers, we need to be able to pass confidential data - like configuration files - without this data being visible to Docker or any other system software. Actually, we recommend that this information is not even visible to the programmer writing the stack file. For example, by having no secrets in the stack file, one can reuse the stack files in different contexts. Moreover, one does not need to change the keys in the stack file if some person that had access to the stack file leaves the company.  </p>
<p>To avoid keys inside of extended stack files, our extensions support the use of a key storage. One can automatically generate new keys or can reuse old keys - say after an update of a compose file. Also, one can share keys between different stacks. </p>
<p>The extended stack file is split by SCONE into a standard compose file and a configuration information that is stored in the key store</p>
<p><img alt="*scone stack deploy*" src="../IMG/scone_stack_deploy.png" /></p>
<p>The command line is similar to that of Docker:</p>
<pre><code class="bash">scone stack deploy [OPTIONS] STACK
</code></pre>

<p>where STACK is the name of the stack file.</p>
<p>Note that the key storage can only be accessed by command <em>scone stack deploy</em> and by the enclaved process. 
The enclaved process needs to show the proper certificate showing that it runs inside an enclave as well as
belong to the same stack. Each stack has a unique ID which is passed - in the clear - to the started secure container. </p>
<h2 id="confidentiality-and-integrity">Confidentiality and Integrity</h2>
<p>We set defaults such that we can use a standard Docker stack file and we will start it that all data is encrypted
by default. A developer can opt-out from these defaults, for example, by not encrypting data that is already encrypted by the application code.  </p>
<h2 id="image-required">image (required)</h2>
<p>A stack is a collection of <em>services</em> and for each service in a <em>stack</em>, one <em>image</em> key must be defined.  To run an secure service (i.e., a service running inside an enclave), we need to specify an enclave certificate. Only a service running inside an enclave matching this certificate can access the environment, arguments and configuration data.</p>
<p>Scone stack will retrieve this certificate from the key store
using the certificate in directory <em>images</em> matching the image name:</p>
<pre><code class="YAML">image: sconecontainers.com/mysql:latest
</code></pre>

<p>In this case, the certificate would be retrieved from the key store via name <em>images/sconecontainers.com/mysql:latest</em>. If this certificate is not found or does not match the actual enclave certificate, this service will not be able to start up. </p>
<p><em>We evaluate the following scone stack extensions.</em></p>
<p>The stack file can specify the enclave certificate explicitly:</p>
<pre><code class="YAML">image: sconecontainers.com/mysql:latest
  enclave-certificate: Base64encoded
</code></pre>

<p>Alternatively, the stack file can specify an alternative key to retrieve the certificate from the
key storage:</p>
<pre><code class="YAML">image: sconecontainers.com/mysql:latest
  enclave-certificate: \(myimage_certificates/sconecontainers.com/mysql:latest)
</code></pre>

<p>To mix secure and standard containers, one can optionally also provide the key <em>insecure-image</em>:</p>
<pre><code class="YAML">image: mysql
  insecure-image
</code></pre>

<p><strong>Summary:</strong> the first version of <em>scone stack</em> will only support certificates that are implicitly loaded from the key store.
Explicit keys inside the stack file or alternative certificate locations, might be supported in future versions of <em>scone stack</em> </p>
<h2 id="devices">devices</h2>
<p>We need to make sure that <em>/dev/isgx</em> is mapped into secure containers. Hence, by default 
<em>scone stack deploy</em> will add the follow device mapping to all secure containers. </p>
<pre><code class="YAML">devices:
  - &quot;/dev/isgx:/dev/isgx&quot;
</code></pre>

<p><strong>Note:</strong> In case this mapping already exists in the stack file, this device mapping is only added once. While Docker compose version 3 does not support device option anymore, stack files do support a device option.</p>
<h2 id="environment">environment</h2>
<p>One can define environment variables that are not visible to docker and are passed in a secure fashion to
the applications. These definitions overwrite the environment variables given in the container image.</p>
<p><strong>Example:</strong></p>
<pre><code class="YAML">environment:
  - RACK_ENV=development
  - SHOW=true
  - SESSION_SECRET=&quot;blabla&quot;
</code></pre>

<p>We can retrieve sensitive entries from the key store before passing this to the application:</p>
<pre><code class="YAML">enclave-environment:
  - RACK_ENV=development
  - SHOW=true
  - SESSION_SECRET=\(vault.{namespace}.MYSQL_ROOT_PASSWORD)
</code></pre>

<p>The evaluation is performed at the time when the program starts up.</p>
<h2 id="pid">pid</h2>
<p>Some applications use the pid to compute random numbers. This is of course not a good idea. Instead of requiring
to change these applications we have an option to set a random pid.  </p>
<pre><code class="YAML">pid: &quot;random&quot;
</code></pre>

<p>We have also support fixed pids, i.e., one can set the pid of this process. To set the process
to 42, just specify:</p>
<pre><code class="YAML">pid: &quot;42&quot;
</code></pre>

<p>SCONE supports also the <strong>pid</strong> options of Docker like "host"  </p>
<h2 id="enclave-tmpfs">enclave-tmpfs</h2>
<p>Mounts a temporary file system. SCONE supports an encrypted temporary file system. 
The key for the temporary file system is randomly chosen:</p>
<pre><code class="YAML">enclaved-tmpfs: /run
enclaved-tmpfs:
  - /run
  - /tmp
</code></pre>

<h2 id="enclave-env_file">enclave-env_file</h2>
<p>We do not support an enclaced version of env_file yet. Please use enclave-environment instead.</p>
<h2 id="enclave-extra_hosts">enclave-extra_hosts:</h2>
<p>Add extra entries to /etc/hosts in a secure fashion:</p>
<pre><code class="YAML">extra_hosts:
 - &quot;somehost:162.242.195.82&quot;
 - &quot;otherhost:50.31.209.229&quot;
</code></pre>

<h2 id="file-protection">file-protection</h2>
<pre><code class="YAML">file-protection:
  fail-on-r-unencrypted;
  fail-on-w-unauthenticated;
</code></pre>

<h2 id="secure-file-inject">secure-file-inject</h2>
<p>One can inject files from the compose host into the image.
<em>secure-file-inject</em> injects files that are not encrypted on the compose host
but must be encrypted in the container. Since sensitive files on the compose host 
should be encrypted too, use this variant only for debugging.</p>
<pre><code class="YAML">secure-file-inject:
  .git-credentials:.git-credentials
</code></pre>

<p>The preferred use of <em>secure-file-inject</em> is to retrieve the file content from 
a key store. The following variant retrieves the content of an injected file from the key store.
This requires to specify a <em>key</em>. This key is used to retrieve the content.
The key is prefixed by the unique key of the <em>deployed stack</em>.</p>
<pre><code class="YAML">secure-file-inject:
  vault:
    key: git-credentials
    file:.git-credentials
</code></pre>

<h2 id="image">image</h2>
<p>specify signer of an image and the version of the image.</p>
<pre><code class="YAML"> image: curated_mysql
     enclave-signer: SCONE-LTD.COM
     enclave-version: 2.1-
</code></pre>

<h2 id="tty">tty</h2>
<pre><code class="YAML">tty: true
    tty-encryption-key:  tty-passwd
</code></pre>

<pre><code class="YAML">tty: true
    tty-encryption-key:  \(TTY-KEY)
</code></pre>

<p>Syntactic sugar for ..:</p>
<pre><code class="YAML">enclave-tty: true
</code></pre>

<h2 id="stdin_open">stdin_open</h2>
<pre><code class="YAML">stdin_open: true
 tty-encryption-key:  in-pswd
</code></pre>

<h2 id="file-encryption">file-encryption</h2>
<h2 id="socket-encryption">socket-encryption</h2>
<h2 id="lease-management">lease management</h2>
<p>We use leases to perform to address the following two problems:</p>
<ul>
<li>
<p>we might need to enforce some periodic rekeying of keys that are included in configuration files</p>
</li>
<li>
<p>we might need to ensure that the number of replicas is bounded, for example, we might only permit one replica of a service. </p>
</li>
</ul>
<p>To solve these two problems we permit to define per service how many leases are permitted and </p>
<p>Hence, we would need to reread all configuration files periodically. </p>
<p>Author: Christof Fetzer, January 2017</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../SCONE_OpenStack/" class="btn btn-neutral float-right" title="SCONE OpenStack Support"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../SCONE_Swarm_Example/" class="btn btn-neutral" title="SCONE Swarm Example"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../SCONE_Swarm_Example/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../SCONE_OpenStack/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
