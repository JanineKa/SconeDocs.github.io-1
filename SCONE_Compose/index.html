<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCONE Compose - SCONE</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "SCONE Compose";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-103149717-2', 'sconedocs.github.io');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> SCONE</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <ul class="subnav">
    <li><span>Tutorial</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="..">Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../outline/">Getting Started</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../appsecurity/">Application-oriented security</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../background/">SCONE Background</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_CLI/">SCONE CLI</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_HOST_SETUP/">SCONE Host Setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_toolchain/">SCONE SGX toolchain</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Curated_Images/">SCONE Curated Images</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_TUTORIAL/">SCONE Tutorial</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_GENERATE_IMAGE/">SCONE Create Image</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Dockerfile/">SCONE Dockerfile</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm_Example/">SCONE Swarm Example</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">SCONE Compose</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#compose-stack-files">Compose / Stack Files</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_CAS/">SCONE CAS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_EE2EE/">Example E2E encryption</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Language Support</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C/">C</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C++/">C++</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Fortran/">Fortran</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../GO/">GO</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Java/">Java</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Python/">Python</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Rust/">Rust</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Manuals</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_HOST/">scone host</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_SERVICE/">scone service</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_STACK/">scone stack</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_SWARM/">scone swarm</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_VOLUME/">scone volume</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Fileshield/">scone fspf</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Appendix</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_ENV/">Environment variables</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../MrEnclave/">MrEnclave</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../ssh/">ssh setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../glossary/">Glossary</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Publications/">Publications</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../aboutScone/">About Scone</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../news/">News</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">SCONE</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorial &raquo;</li>
        
      
    
    <li>SCONE Compose</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="compose-stack-files">Compose / Stack Files</h1>
<p>SCONE supports to run secure applications  consisting of multiple secure containers. To do so, SCONE introduces slightly extended Docker <a href="https://docs.docker.com/compose/"><em>compose</em></a> file. Such an extended compose file defines for each process that runs inside of an enclave, a unique hash value (<strong>MRENCLAVE</strong>). During startup, SCONE performs an <em>attestation</em> for all these <em>secure processes</em> to ensure that the hash of the started program is as expected, i.e., is equal to <strong>MRENCLAVE</strong>. Only if it is equal, the arguments and the environment variables are passed to the process. In this way, we can pass secrets as arguments or environment variables in a secure fashion to a secure process.</p>
<p>By default, all containers are started with SCONE and the arguments are passed in a secure fashion to the started processes. However, you might not want to run all processes inside of enclaves. For containers that should be directly started with Docker Swarm, you need to set field <strong>not_scone: "true"</strong>. In this case, all arguments and the environment variables are directly passed to the container with Docker Swarm (instead of SCONE).</p>
<p>Let's consider an example, that consists of a <em>haproxy</em> that runs in native mode and is directly started with Docker Swarm (indicated by line <strong>not_scone: "true"</strong>) Moreover, we start <em>myapp</em> (defined in container image <em>myapp-image</em>) and specify <strong>MRENCLAVE</strong>. Only after ensuring that the program started in the enclave has the expected <strong>MRENCLAVE</strong> the arguments and the environment variables are passed to <em>myapp</em>.</p>
<pre><code class="YAML">version: &quot;3.1.scone&quot;
services:
    primary-service:
        image: myapp-image:latest
        command: /myapp arg1 arg2 arg3 $my_password
        mrenclave: 5764436f08dd4cdb526f082be1a07a3422f79ef2b01a5e24f78f9034a838c335
        environment:
            - SECURE_ENV=value
            - MY_PIN=$my_pin
            - MY_PASSWORD=$my_password
        working_dir: /
    proxy:
        image: haproxy
        command: haproxy --read_config_from_environ
        not_scone: &quot;true&quot;
        environment:
            - &quot;HAPROXY_CONFIG=a=b,c=d,3=4&quot;
secrets:
    my_pin:
        kind: numeric
        length: &quot;4&quot;
    my_password:
        kind: ascii
        length: &quot;8&quot;
</code></pre>

<p>The extended compose file is split by SCONE into a standard compose file and a configuration information that is stored in the SCONE <em>Configruation and Attestation Service</em> (<strong>CAS</strong>):</p>
<p><img alt="*scone stack deploy*" src="../img/SCONE-compose.png" /></p>
<p>In the current version of scone, we assume that the compose file is stored on a trusted host. (We plan to support compose files stored on untrusted host in the near future.)</p>
<p>The <em>split</em> functionality is part of the <strong>scone CLI</strong>, i.e., you can split a compose file via</p>
<pre><code class="bash">$ scone cas split &lt;COMPOSE_FILE&gt; --stack &lt;STACK_ID&gt;
</code></pre>

<p>The stack ID is a randomly chose unique ID.</p>
<p>This creates a stack file that can be used to start a set of services in your Swarm. Read <a href="../SCONE_EE2EE/">nginx example</a> for some more details how to do this.</p>
<p>To be able to use a CAS, you are required to login to a CAS. We assume that your CAS is available at IP address <strong>$IP</strong>. If you have set up the CAS in the way specified in <a href="../SCONE_CAS/">CAS Setup</a>, set environment variable IP to the external IP address of the swarm manager node.</p>
<p>You can login into CAS via:</p>
<pre><code class="bash">$ scone cas login --host $IP:8081:18765
</code></pre>

<p>See <a href="../SCONE_EE2EE/">nginx example</a> for some more details and read <a href="../SCONE_CAS/">CAS Setup</a> to learn how to run a CAS service for development.</p>
<p>&copy; <a href="http://www.scontain.com">scontain.com</a>, March 2018. <a href="mailto:info@scontain.com">Questions or Suggestions?</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../SCONE_CAS/" class="btn btn-neutral float-right" title="SCONE CAS"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../SCONE_Swarm_Example/" class="btn btn-neutral" title="SCONE Swarm Example"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../SCONE_Swarm_Example/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../SCONE_CAS/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
