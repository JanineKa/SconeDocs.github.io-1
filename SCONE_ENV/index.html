<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCONE Environment variables - SCONE</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "SCONE Environment variables";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-103149717-2', 'sconedocs.github.io');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> SCONE</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Introduction</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../outline/">Getting Started</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../appsecurity/">Application-oriented security</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../background/">SCONE Background</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_CLI/">SCONE CLI</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_HOSTINSTALLER_README/">SCONE Host Setup</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_COMPILER_CONTAINER_README/">SCONE SGX toolchain</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Curated_Images/">SCONE Curated Images</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_TUTORIAL/">SCONE Tutorial</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_GENERATE_IMAGE/">SCONE Create Image</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Dockerfile/">SCONE Dockerfile</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm_Example/">SCONE Swarm Example</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Compose/">SCONE Compose</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Fileshield/">SCONE File Protection</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../Python/">Python</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../GO/">GO</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">SCONE Environment variables</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#scone-environment-variables">SCONE Environment Variables</a></li>
                
                    <li><a class="toctree-l4" href="#scone-configuration-file">SCONE Configuration File</a></li>
                
                    <li><a class="toctree-l4" href="#run-mode">Run Mode</a></li>
                
                    <li><a class="toctree-l4" href="#debug">Debug</a></li>
                
                    <li><a class="toctree-l4" href="#dynamic-library-support">Dynamic library support:</a></li>
                
                    <li><a class="toctree-l4" href="#performance-tuning-variables">Performance tuning variables:</a></li>
                
                    <li><a class="toctree-l4" href="#safety">Safety</a></li>
                
                    <li><a class="toctree-l4" href="#dynamic-link-loader">Dynamic link loader</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_HOST/">manual scone host</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_SWARM/">manual scone swarm</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Publications/">SCONE Publications</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../glossary/">Glossary</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../aboutScone/">About Scone</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">SCONE</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>SCONE Environment variables</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="scone-environment-variables">SCONE Environment Variables</h1>
<p>To simplify development and debugging, SCONE supports a range of environment variables to control its behavior. These environment variables are mainly used for development and debugging. In operational settings, the configuration would be provided in a secure fashion via the SCONE configuration and attestation service.</p>
<p>Also, the performance of SCONE-based applications can be tuned by selecting the appropriate configuration for an application. We have tool support to automatically tune these parameters.</p>
<h2 id="scone-configuration-file">SCONE Configuration File</h2>
<p>The location of the SCONE configuration file can be controlled with an environment variable:</p>
<ul>
<li><strong>SCONE_CONFIG</strong>: if defined, this determines the path of SCONE configuration file. If this environment variable is not defined or the file cannot be opened,  the default configuration file located in <em>/etc/sgx-musl.conf</em> is read instead. If the default configuration file cannot be read either, the program exits with an error message.</li>
</ul>
<p>Changing the location of the configuration file is, for example, useful in the context of testing or when you run your application outside of a container when you want to run different applications with different configurations inside of enclaves.</p>
<p>The configuration file can define most of the  behaviors that one can define via environment variables.
However, the <strong>SCONE_* </strong> environment variables have higher priority than the settings from the config file.</p>
<h3 id="format-of-scone-configuration-file">Format of SCONE Configuration File</h3>
<p>The format for the configuration file: on each line, there is a
statement beginning with a single-character command code, and up to
three numbers. The possible commands currently are:</p>
<ul>
<li>Q <strong>n</strong>  - defines the number of queues used to execute system calls<ul>
<li><strong>n = number of queues</strong>: sets the number of syscall-return queue pairs to allocate. This is equivalent to setting the <strong>SCONE_QUEUES</strong> environment variable;</li>
</ul>
</li>
<li>H <strong>s</strong> - defines the heap size in bytes<ul>
<li><strong>s = heap size in bytes</strong>: sets the size of heap, equivalent to setting <strong>SCONE_HEAP</strong> environment variable;</li>
</ul>
</li>
<li>P <strong>N</strong> - determines the backoff behavior of the queues<ul>
<li><strong>N = spin number</strong>: equivalent to setting <strong>SCONE_SSPINS</strong> environment variable;</li>
</ul>
</li>
<li>L <strong>S</strong> - determines the backoff behavior of the queues<ul>
<li><strong>S = sleep time</strong>: equivalent to setting <strong>SCONE_SSLEEP</strong> environment variable;</li>
</ul>
</li>
<li>s <strong>C Q R</strong>  - <em>sthread</em> serving system calls outside of an enclave<ul>
<li><strong>C = core-no</strong>: if non-negative number: pin this sthread to core <strong>C</strong>; if a negative number, do not pin this thread</li>
<li><strong>Q = queue-no in [0..n]</strong>: this sthreads serves this queue</li>
<li><strong>R = realtime?</strong>: always set this to 0</li>
</ul>
</li>
<li>e <strong>C Q R</strong>  <em>ethread</em> running inside of enclave and executes application threads (which we call lthreads)<ul>
<li><strong>C = core-no</strong>: non-negative number: pin to this core; negative number: no pinning ot this thread</li>
<li><strong>Q = queue-no in [0..n]</strong>: this sthreads serves this queue</li>
<li><strong>R = realtime?</strong>: always set this to 0</li>
</ul>
</li>
</ul>
<p><strong>Note</strong> For now, the number of <em>sthreads</em> should always be larger than the number of  <em>lthreads</em> blocked in system calls.
In a first approximation, you could set the number of <em>sthreads</em> as follows.</p>
<p><center><strong> # sthreads  =  # ethreads + # lthreads </strong> </center></p>
<p>We plan to automatically adjust the number of <em>sthreads</em> and <em>ethreads</em> in the future. </p>
<h2 id="run-mode">Run Mode</h2>
<ul>
<li>
<p><strong>SCONE_MODE</strong>: defines if application should run inside of an enclave or outside in simulation mode.</p>
<ul>
<li>
<p><strong>=HW</strong>: run program inside of enclave. If program fails to create an enclave, it will fail.</p>
</li>
<li>
<p><strong>=SIM</strong>: run program outside of enclave. All SCONE related software runs but just outside of the enclave. This is not 100% compatible with hardware mode since, for example, some instructions are permitted in native mode that are not permitted in hardware mode.</p>
</li>
<li>
<p><strong>=AUTO</strong>: run program inside of enclave if SGX is available. Otherwise, run in simulation mode.</p>
</li>
</ul>
</li>
<li>
<p><strong>SCONE_HEAP</strong>: size of the heap allocated for the program during the startup of the enclave.</p>
<ul>
<li><strong>=s</strong>  the requested heap size in bytes</li>
</ul>
</li>
</ul>
<h2 id="debug">Debug</h2>
<ul>
<li><strong>SCONE_VERSION</strong> if defined, SCONE will print the values of some of the SCONE environment variables during startup.</li>
</ul>
<p>Example output:</p>
<pre><code class="bash">export SCONE_QUEUES=4
export SCONE_SLOTS=256
export SCONE_SIGPIPE=0
export SCONE_MMAP32BIT=0
export SCONE_SSPINS=100
export SCONE_SSLEEP=4000
export SCONE_KERNEL=0
export SCONE_HEAP=1073741824
export SCONE_CONFIG=/etc/sgx-musl.conf
export SCONE_MODE=hw
export SCONE_SGXBOUNDS=no
export SCONE_ALLOW_DLOPEN=no
Revision: 9b355b99170ad434010353bb9f4dca24e532b1b7
Branch: master
Configure options: --enable-file-prot --enable-shared --enable-debug --prefix=/scone/src/built/cross-compiler/x86_64-linux-musl
</code></pre>

<h2 id="dynamic-library-support">Dynamic library support:</h2>
<ul>
<li>
<p><strong>SCONE_ALLOW_DLOPEN</strong>: if defined, permit to load shared libraries during startup. All libraries that are loaded during startup are measured and contribute to the hash of the enclave, i.e., the are part of <em>MRENCLAVE</em>.</p>
</li>
<li>
<p><strong>SCONE_ALLOW_DLOPEN="2"</strong>: not only can dynamic libraries be loaded during startup but also later on. For example, Python programs might dynamically load modules after startup. Our approach to enforce the integrity of these dynamic libraries with the help of a file protection shield.</p>
</li>
</ul>
<h2 id="performance-tuning-variables">Performance tuning variables:</h2>
<ul>
<li>
<p><strong>SCONE_QUEUES</strong>: number of systemcall queues to be used.</p>
</li>
<li>
<p><strong>SCONE_SLOTS</strong>: systemcall queue length: must be larger than the maximum number of <em>lthreads</em>.</p>
</li>
<li>
<p><strong>SCONE_SIGPIPE</strong>: if set to "1", <em>SIGPIPE</em> signals are delivered to the application</p>
</li>
<li>
<p><strong>SCONE_SSPINS=N</strong>: In case an Ethread does not have any lthread to execute, an Ethread first pauses for up to N times to wait for more work to show up. After that, it sleeps for up to N times. Each time increasing the sleep time. </p>
</li>
<li>
<p><strong>SCONE_SSLEEP</strong>: determines how fast we increase the backoff.</p>
</li>
</ul>
<h2 id="safety">Safety</h2>
<ul>
<li><strong>SCONE_SGXBOUNDS</strong>: must be defined to enable bounds checking. Furthermore, you need to compile your program with our SGX boundschecker.</li>
</ul>
<h2 id="dynamic-link-loader">Dynamic link loader</h2>
<p>The dynamic link loader is part of image <em>sconecuratedimages/crosscompilers:runtime</em> (<a href="../SCONE_TUTORIAL/">see tutorial</a>).</p>
<ul>
<li>
<p><strong>LD_LIBRARY_PATH</strong>: you can control from where the dynamic link loader looks for shared libraries.</p>
</li>
<li>
<p><strong>LD_PRELOAD</strong>: you can instruct the dynamic link loader to load libraries before loading the libraries specified by the program itself.</p>
</li>
<li>
<p><strong>SCONE_ALPINE=1</strong>: run dynamically-linked program inside of an enclave.</p>
</li>
</ul>
<p>&copy; <a href="http://www.scontain.com">scontain.com</a>, November 2017. <a href="mailto:info@scontain.com">Questions or Suggestions?</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../SCONE_HOST/" class="btn btn-neutral float-right" title="manual scone host"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../GO/" class="btn btn-neutral" title="GO"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../GO/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../SCONE_HOST/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
