<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GO - SCONE</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "GO";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-103149717-2', 'sconedocs.github.io');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> SCONE</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Introduction</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../outline/">Getting Started</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../appsecurity/">Application-oriented security</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../background/">SCONE Background</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_CLI/">SCONE CLI</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_HOST_SETUP/">SCONE Host Setup</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_toolchain/">SCONE SGX toolchain</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Curated_Images/">SCONE Curated Images</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_TUTORIAL/">SCONE Tutorial</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_GENERATE_IMAGE/">SCONE Create Image</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Dockerfile/">SCONE Dockerfile</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Swarm_Example/">SCONE Swarm Example</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Compose/">SCONE Compose</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_EE2EE/">Example E2E encryption</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../C/">C</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../C++/">C++</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../Fortran/">Fortran</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">GO</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#go">GO</a></li>
                
            
                <li class="toctree-l3"><a href="#example">Example</a></li>
                
                    <li><a class="toctree-l4" href="#debugging">Debugging</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../Python/">Python</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../Rust/">Rust</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_HOST/">manual scone host</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_SERVICE/">manual scone service</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_STACK/">manual scone stack</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_SWARM/">manual scone swarm</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_VOLUME/">manual scone volume</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Fileshield/">manual scone fspf</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_ENV/">Environment variables</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../SCONE_Publications/">Publications</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../glossary/">Glossary</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../aboutScone/">About Scone</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">SCONE</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>GO</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="go">GO</h1>
<p>SCONE supports cross-compiling GO programs to run these inside of SGX enclaves. The GO cross-compiler is part of image <strong>sconecuratedimages/crosscompilers:scone</strong>.</p>
<h1 id="example">Example</h1>
<p>Start the SCONE crosscompiler container:</p>
<pre><code class="bash">&gt; docker run -it -p 8080:8080 sconecuratedimages/crosscompilers:scone
$
</code></pre>

<p>Lets consider a simple GO program (take from a <a href="https://golang.org/doc/articles/wiki/">GO tutorial</a>):</p>
<pre><code class="bash">$ cat &gt; web-srv.go &lt;&lt; EOF
package main

import (
    &quot;fmt&quot;
    &quot;net/http&quot;
)

func handler(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, &quot;Hi there, I love %s!&quot;, r.URL.Path[1:])
    if r.URL.Path[1:] == &quot;EXIT&quot; {
        os.Exit(0)
    }
}

func main() {
    http.HandleFunc(&quot;/&quot;, handler)
    http.ListenAndServe(&quot;:8080&quot;, nil)
}
EOF
</code></pre>

<p>You can cross-compile this program as follows:</p>
<pre><code class="bash">$ SCONE_HEAP=1G scone-gccgo web-srv.go -O3 -o web-srv-go -g
</code></pre>

<p>You can start the compiled program (and enable some debug messages) as follows:</p>
<pre><code class="bash">$ SCONE_VERSION=1 ./web-srv-go &amp;
export SCONE_QUEUES=4
export SCONE_SLOTS=256
export SCONE_SIGPIPE=0
export SCONE_MMAP32BIT=0
export SCONE_SSPINS=100
export SCONE_SSLEEP=4000
export SCONE_KERNEL=0
export SCONE_HEAP=1073741824
export SCONE_CONFIG=/etc/sgx-musl.conf
export SCONE_MODE=hw
export SCONE_SGXBOUNDS=no
export SCONE_ALLOW_DLOPEN=no
Revision: 9b355b99170ad434010353bb9f4dca24e532b1b7
Branch: master
Configure options: --enable-file-prot --enable-shared --enable-debug --prefix=/scone/src/built/cross-compiler/x86_64-linux-musl


</code></pre>

<p>You can now connect to port 8080, for example, with <em>curl</em>:</p>
<pre><code class="bash">$ curl localhost:8080/SCONE
Hi there, I love SCONE!
</code></pre>

<p>You can terminate the server with</p>
<pre><code class="bash">$ curl localhost:8080/EXIT
curl: (52) Empty reply from server
</code></pre>

<h2 id="debugging">Debugging</h2>
<p>SCONE supports debugging of programs running inside of an enclave with the help of gdb.</p>
<h3 id="debugging-inside-of-a-container">Debugging inside of a container</h3>
<p>Standard containers have not sufficient rights to use the debugger.  Hence, you must start a container with <em>SYS_PTRACE</em> capability. For example:</p>
<pre><code class="bash">docker run --cap-add SYS_PTRACE -it -p 8080:8080 -v &quot;$PWD&quot;/EXAMPLE:/usr/src/myapp -w /usr/src/myapp  sconecuratedimages/crosscompilers:scone
</code></pre>

<h3 id="handling-illegal-instructions">Handling Illegal instructions</h3>
<p>Some instructions, like CPUID, are not permitted inside of enclaves. For some of these instructions, like CPUID, we provide an automatic emulation. However, we recommend not to use any illegal instructions inside of enclaves despite having an automatic emulation of these instructions. For example, we provide static replacements of the CPUID instruction. </p>
<p>If your program contains some illegal instructions, you need to ask the debugger to forward the signals,
that these illegal instructions cause, to the program via <strong>handle SIGILL nostop pass</strong>: </p>
<pre><code class="bash">scone-gdb ./web-srv-go
GNU gdb (Ubuntu 7.12.50.20170314-0ubuntu1.1) 7.12.50.20170314-git
Copyright (C) 2017 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;x86_64-linux-gnu&quot;.
Type &quot;show configuration&quot; for configuration details.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
&lt;http://www.gnu.org/software/gdb/documentation/&gt;.
For help, type &quot;help&quot;.
Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...
Source directories searched: /opt/scone/scone-gdb/gdb-sgxmusl-plugin:$cdir:$cwd
Setting environment variable &quot;LD_PRELOAD&quot; to null value.
Reading symbols from ./web-srv-go...done.
[SCONE] Initializing...
(gdb) handle SIGILL nostop pass
Signal        Stop  Print   Pass to program Description
SIGILL        No    Yes Yes     Illegal instruction
(gdb)
</code></pre>

<p>Since we do not patch the CPUID instructions in this run, you will see something like this:</p>
<pre><code class="bash">(gdb) run
Starting program: /usr/src/myapp/web-srv-go 
warning: Error disabling address space randomization: Operation not permitted
[Thread debugging using libthread_db enabled]
Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.
[SCONE] Enclave base: 1000000000
[SCONE] Loaded debug symbols
[New Thread 0x7f1786d26700 (LWP 105)]
[New Thread 0x7f1786525700 (LWP 106)]
[New Thread 0x7f1785d24700 (LWP 107)]
[New Thread 0x7f1785523700 (LWP 108)]
[New Thread 0x7f1787502700 (LWP 109)]
[New Thread 0x7f17874fa700 (LWP 110)]
[New Thread 0x7f17874f2700 (LWP 111)]
[New Thread 0x7f17874ea700 (LWP 112)]

Thread 6 &quot;web-srv-go&quot; received signal SIGILL, Illegal instruction.

Thread 6 &quot;web-srv-go&quot; received signal SIGILL, Illegal instruction.

Thread 6 &quot;web-srv-go&quot; received signal SIGILL, Illegal instruction.

Thread 6 &quot;web-srv-go&quot; received signal SIGILL, Illegal instruction.

Thread 6 &quot;web-srv-go&quot; received signal SIGILL, Illegal instruction.

Thread 8 &quot;web-srv-go&quot; received signal SIGILL, Illegal instruction.

</code></pre>

<p>You could interrupt this execution via control c:</p>
<pre><code class="bash">^C
Thread 1 &quot;web-srv-go&quot; received signal SIGINT, Interrupt.
0x00007f17870f69dd in pthread_join (threadid=139739022911232, thread_return=0x7ffe1c807928) at pthread_join.c:90
90  pthread_join.c: No such file or directory.
(gdb) where
#0  0x00007f17870f69dd in pthread_join (threadid=139739022911232, thread_return=0x7ffe1c807928) at pthread_join.c:90
#1  0x0000002000004053 in main (argc=1, argv=0x7ffe1c807c18, envp=0x7ffe1c807c28) at ./tools/starter-exec.c:764
(gdb) cont
Continuing.
</code></pre>

<h3 id="breakpoints">Breakpoints</h3>
<p>Of course, you might also set breakpoints. Say, we want to get control in the debugger whenever a request is being
processed by the handler. We would set a breakpoint at function <strong>main.handler</strong> as follows:</p>
<pre><code class="bash">&gt; scone-gdb ./web-srv-go
...
[SCONE] Initializing...
(gdb) handle SIGILL nostop pass
Signal        Stop      Print   Pass to program Description
SIGILL        No        Yes     Yes             Illegal instruction
(gdb) break main.handler
Function &quot;main.handler&quot; not defined.
Make breakpoint pending on future shared library load? (y or [n]) y
Breakpoint 1 (main.handler) pending.
(gdb) run
Starting program: /usr/src/myapp/web-srv-go 
warning: Error disabling address space randomization: Operation not permitted
[Thread debugging using libthread_db enabled]
Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.
[SCONE] Enclave base: 1000000000
[SCONE] Loaded debug symbols
[New Thread 0x7fb6cad32700 (LWP 243)]
[New Thread 0x7fb6ca531700 (LWP 244)]
[New Thread 0x7fb6c9d30700 (LWP 245)]
[New Thread 0x7fb6c952f700 (LWP 246)]
[New Thread 0x7fb6cb50e700 (LWP 247)]
[New Thread 0x7fb6cb506700 (LWP 248)]
[New Thread 0x7fb6cb4fe700 (LWP 249)]
[New Thread 0x7fb6cb4f6700 (LWP 250)]

Thread 6 &quot;web-srv-go&quot; received signal SIGILL, Illegal instruction.

Thread 6 &quot;web-srv-go&quot; received signal SIGILL, Illegal instruction.

Thread 6 &quot;web-srv-go&quot; received signal SIGILL, Illegal instruction.

Thread 6 &quot;web-srv-go&quot; received signal SIGILL, Illegal instruction.

Thread 6 &quot;web-srv-go&quot; received signal SIGILL, Illegal instruction.

Thread 6 &quot;web-srv-go&quot; received signal SIGILL, Illegal instruction.
</code></pre>

<p>Note that at the time when we are setting the breakpoint, the symbols of the code running inside
of the enclave are not yet known. Hence, we just let gdb know that the symbol will be defined later on.</p>
<p>We are now sending a request with the help of <em>curl</em> from a different window. This triggers the breakpoint:</p>
<pre><code class="bash">[Switching to Thread 0x7fb6cb506700 (LWP 248)]

Thread 7 &quot;web-srv-go&quot; hit Breakpoint 1, main.handler (w=..., r=0x100909e300) at web-srv.go:8
8       func handler(w http.ResponseWriter, r *http.Request) {
(gdb) n
9           fmt.Fprintf(w, &quot;Hi there, I love %s!&quot;, r.URL.Path[1:])
(gdb) n
8       func handler(w http.ResponseWriter, r *http.Request) {
(gdb) c
Continuing.
</code></pre>

<p>&copy; <a href="http://www.scontain.com">scontain.com</a>, November 2017. <a href="mailto:info@scontain.com">Questions or Suggestions?</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Python/" class="btn btn-neutral float-right" title="Python"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Fortran/" class="btn btn-neutral" title="Fortran"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Fortran/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Python/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
